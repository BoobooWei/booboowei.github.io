<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>MongoDB 基础课程 | BoobooWei</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.toberoot.com/database/nosql/booboo_mongodb/00-mongodb%E8%AF%BE%E7%A8%8B">
  <!-- Alternate links -->
  
    
      
    
    <link rel="alternate" hreflang="x-default" href="http://www.toberoot.com/database/nosql/booboo_mongodb/00-mongodb%E8%AF%BE%E7%A8%8B" />
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="../../../icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="../../../icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="../../../icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="../../../icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="../../../icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../../../icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../../../icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../../../icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="../../../icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="../../../icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="../../../icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="../../../icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="../../../icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="../../../icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  
<link rel="stylesheet" href="../../../css/navy.css">

  <!-- endbuild -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-lato@0.0.75/index.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="../../../atom.xml" title="BoobooWei" type="application/atom+xml">
  <!-- Open Graph -->
  <meta name="description" content="课程要求 熟悉 MongoDB 数据库各种概念 学会 MongoDB 的搭建 熟悉 MongoDB 的使用 简单运维  概念NoSQL 简介NoSQL(NoSQL &#x3D; Not Only SQL )，意即”不仅仅是SQL”。 NoSQL，指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。 NoSQL用于超大规模数">
<meta property="og:type" content="website">
<meta property="og:title" content="MongoDB 基础课程">
<meta property="og:url" content="http://www.toberoot.com/database/nosql/booboo_mongodb/00-mongodb%E8%AF%BE%E7%A8%8B">
<meta property="og:site_name" content="BoobooWei">
<meta property="og:description" content="课程要求 熟悉 MongoDB 数据库各种概念 学会 MongoDB 的搭建 熟悉 MongoDB 的使用 简单运维  概念NoSQL 简介NoSQL(NoSQL &#x3D; Not Only SQL )，意即”不仅仅是SQL”。 NoSQL，指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。 NoSQL用于超大规模数">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://www.toberoot.com/icon/og-image-wide.png">
<meta property="article:published_time" content="2025-10-22T08:53:55.867Z">
<meta property="article:modified_time" content="2025-10-22T08:49:24.715Z">
<meta property="article:author" content="魏亚萍">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.toberoot.com/icon/twitter-summary.png">
<meta property="fb:admins" content="100000247608790">
  <!-- Google Analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48498357-3', 'auto');
  ga('send', 'pageview');
</script>

  <!-- Algolia -->
  <link rel="preconnect" href="https://-dsn.algolia.net" crossorigin />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
<meta name="generator" content="Hexo 8.0.0"></head>

<body>
  <div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="../../../" id="logo">Hexo</a>
    </h1>
    <nav id="main-nav">
      <a href="../../../docs/" class="main-nav-link">Hexo</a><a href="../../../news/" class="main-nav-link">News</a><a href="../../../api/" class="main-nav-link">MySQL8.0</a><a href="../../../database/" class="main-nav-link">Database</a><a href="../../../linux/" class="main-nav-link">Linux</a><a href="../../../cloud/" class="main-nav-link">Cloud</a><a href="../../../singapore/" class="main-nav-link">Singapore</a><a href="../../../amy/" class="main-nav-link">AMY</a><a href="../../../about/" class="main-nav-link">About</a>
      <a target="_blank" rel="noopener" href="https://github.com/BoobooWei" class="main-nav-link"><i class="fa fa-github-alt"></i></a>

      <div id="search-input-wrap">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <div id="lang-select-wrap">
        <a href="/about/" class="main-nav-link"><label id="lang-select-label"><i class="fa fa-globe"></i><span>关于我</span></label></a>
    </div>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name">MongoDB 基础课程</h1>
                <a target="_blank" rel="noopener" href="https://github.com/BoobooWei/site/edit/master/source/database/nosql/booboo_mongodb/00-mongodb课程.md" class="article-edit-link" title="Improve this doc"><i class="fa fa-pencil"></i></a>
              </header>
              <div class="article-content" itemprop="articleBody">
                <html><head></head><body><h2 id="课程要求" class="article-heading"><a href="#课程要求" class="headerlink" title="课程要求"></a>课程要求<a class="article-anchor" href="#课程要求" aria-hidden="true"></a></h2><ul>
<li>熟悉 MongoDB 数据库各种概念</li>
<li>学会 MongoDB 的搭建</li>
<li>熟悉 MongoDB 的使用</li>
<li>简单运维</li>
</ul>
<h2 id="概念" class="article-heading"><a href="#概念" class="headerlink" title="概念"></a>概念<a class="article-anchor" href="#概念" aria-hidden="true"></a></h2><h3 id="NoSQL-简介" class="article-heading"><a href="#NoSQL-简介" class="headerlink" title="NoSQL 简介"></a>NoSQL 简介<a class="article-anchor" href="#NoSQL-简介" aria-hidden="true"></a></h3><p>NoSQL(NoSQL = Not Only SQL )，意即”不仅仅是SQL”。</p>
<p>NoSQL，指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。</p>
<p>NoSQL用于超大规模数据的存储。（例如谷歌或Facebook每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。</p>
<h3 id="为什么使用NoSQL" class="article-heading"><a href="#为什么使用NoSQL" class="headerlink" title="为什么使用NoSQL ?"></a>为什么使用NoSQL ?<a class="article-anchor" href="#为什么使用NoSQL" aria-hidden="true"></a></h3><p>今天我们可以通过第三方平台（如：Google,Facebook等）可以很容易的访问和抓取数据。用户的个人信息，社交网络，地理位置，用户生成的数据和用户操作日志已经成倍的增加。我们如果要对这些用户数据进行挖掘，那SQL数据库已经不适合这些应用了, NoSQL数据库的发展却能很好的处理这些大的数据。</p>
<p>NoSQL纪元</p>
<p>当下已经存在很多的NoSQL数据库，比如MongoDB、Redis、Riak、HBase、Cassandra等等。每一个都拥有以下几个特性中的一个：</p>
<ul>
<li>不再使用SQL语言，比如MongoDB、Cassandra就有自己的查询语言</li>
<li>通常是开源项目</li>
<li>为集群运行而生</li>
<li>弱结构化——不会严格的限制数据结构类型</li>
</ul>
<h3 id="NoSQL-数据库的类型一览表" class="article-heading"><a href="#NoSQL-数据库的类型一览表" class="headerlink" title="NoSQL 数据库的类型一览表"></a>NoSQL 数据库的类型一览表<a class="article-anchor" href="#NoSQL-数据库的类型一览表" aria-hidden="true"></a></h3><table>
<thead>
<tr>
<th align="left">数据库类型</th>
<th align="left">描述</th>
<th align="left">主流产品</th>
<th align="left">有谁在用</th>
<th align="left">适用场景</th>
<th align="left">不适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">键值（Key-Value）数据库</td>
<td align="left">键值数据库就像在传统语言中使用的哈希表。你可以通过 key 来添加、查询或者删除数据，鉴于使用主键访问，所以会获得不错的性能及扩展性。</td>
<td align="left">Riak、Redis、Memcached、Amazon’s Dynamo、Project Voldemort</td>
<td align="left">GitHub （Riak）、BestBuy （Riak）、Twitter （Redis和Memcached）、StackOverFlow （Redis）、 Instagram （Redis）、Youtube （Memcached）、Wikipedia（Memcached）</td>
<td align="left">储存用户信息，比如会话、配置文件、参数、购物车等等。这些信息一般都和 ID（键）挂钩，这种情景下键值数据库是个很好的选择。</td>
<td align="left">1. 取代通过键查询，而是通过值来查询。Key-Value 数据库中根本没有通过值查询的途径。2. 需要储存数据之间的关系。在 Key-Value 数据库中不能通过两个或以上的键来关联数据。3. 事务的支持。在 Key-Value 数据库中故障产生时不可以进行回滚。</td>
</tr>
<tr>
<td align="left">面向文档（Document-Oriented）数据库</td>
<td align="left">面向文档数据库会将数据以文档的形式储存。每个文档都是自包含的数据单元，是一系列数据项的集合。每个数据项都有一个名称与对应的值，值既可以是简单的数据类型，如字符串、数字和日期等；也可以是复杂的类型，如有序列表和关联对象。数据存储的最小单位是文档，同一个表中存储的文档属性可以是不同的，数据可以使用 XML、JSON 或者 JSONB 等多种形式存储。</td>
<td align="left">MongoDB、CouchDB、RavenDB</td>
<td align="left">SAP （MongoDB）、Codecademy （MongoDB）、Foursquare （MongoDB）、NBC News （RavenDB）</td>
<td align="left">1. 日志。企业环境下，每个应用程序都有不同的日志信息。Document-Oriented 数据库并没有固定的模式，所以我们可以使用它储存不同的信息。2. 分析。鉴于它的弱模式结构，不改变模式下就可以储存不同的度量方法及添加新的度量。</td>
<td align="left">在不同的文档上添加事务。Document-Oriented 数据库并不支持文档间的事务，如果对这方面有需求则不应该选用这个解决方案。</td>
</tr>
<tr>
<td align="left">列存储（Wide Column Store/Column-Family）数据库</td>
<td align="left">列存储数据库将数据储存在列族（column family）中，一个列族存储经常被一起查询的相关数据。举个例子，如果我们有一个 Person 类，我们通常会一起查询他们的姓名和年龄而不是薪资。这种情况下，姓名和年龄就会被放入一个列族中，而薪资则在另一个列族中。</td>
<td align="left">Cassandra、HBase</td>
<td align="left">Ebay （Cassandra）、Instagram （Cassandra）、NASA （Cassandra）、Twitter （Cassandra and HBase）、Facebook （HBase）、Yahoo!（HBase）</td>
<td align="left">1. 日志。因为我们可以将数据储存在不同的列中，每个应用程序可以将信息写入自己的列族中。2. 博客平台。我们储存每个信息到不同的列族中。举个例子，标签可以储存在一个，类别可以在一个，而文章则在另一个。</td>
<td align="left">1. 如果我们需要 ACID 事务。Vassandra 就不支持事务。2. 原型设计。如果我们分析Cassandra 的数据结构，我们就会发现结构是基于我们期望的数据查询方式而定。在模型设计之初，我们根本不可能去预测它的查询方式，而一旦查询方式改变，我们就必须重新设计列族。</td>
</tr>
<tr>
<td align="left">图（Graph-Oriented）数据库</td>
<td align="left">图数据库允许我们将数据以图的方式储存。实体会被作为顶点，而实体之间的关系则会被作为边。比如我们有三个实体，Steve Jobs、Apple 和 Next，则会有两个“Founded by”的边将 Apple 和 Next 连接到 Steve Jobs。</td>
<td align="left">Neo4J、Infinite Graph、OrientDB</td>
<td align="left">Adobe （Neo4J）、Cisco （Neo4J）、T-Mobile （Neo4J）</td>
<td align="left">1. 在一些关系性强的数据中2. 推荐引擎。如果我们将数据以图的形式表现，那么将会非常有益于推荐的制定 不适合的数据模型。图数据库的适用范围很小，因为很少有操作涉及到整个图。</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="MongoDB-简介" class="article-heading"><a href="#MongoDB-简介" class="headerlink" title="MongoDB 简介"></a>MongoDB 简介<a class="article-anchor" href="#MongoDB-简介" aria-hidden="true"></a></h3><h4 id="网站" class="article-heading"><a href="#网站" class="headerlink" title="网站"></a>网站<a class="article-anchor" href="#网站" aria-hidden="true"></a></h4><ul>
<li>mongoDB 官网 <a target="_blank" rel="noopener" href="http://www.mongodb.org/">www.mongodb.org</a></li>
<li>mongoDB 中文官网 <a target="_blank" rel="noopener" href="http://www.mongoing.com/">www.mongoing.com</a></li>
<li>github.com/mongodb</li>
<li>jira.mongodb.org #bug</li>
</ul>
<p>MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。</p>
<p>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。</p>
<h4 id="分布式文件系统" class="article-heading"><a href="#分布式文件系统" class="headerlink" title="分布式文件系统"></a>分布式文件系统<a class="article-anchor" href="#分布式文件系统" aria-hidden="true"></a></h4><p>分布式文件系统（Distributed File System）是指文件系统管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连。分布式文件系统的设计基于客户机/服务器模式。一个典型的网络可能包括多个供多用户访问的服务器。另外，对等特性允许一些系统扮演客户机和服务器的双重角色。</p>
<h4 id="文档" class="article-heading"><a href="#文档" class="headerlink" title="文档"></a>文档<a class="article-anchor" href="#文档" aria-hidden="true"></a></h4><p>文档是 MongoDB 中数据的基本单位，类似于关系数据库中的行（但是比行复杂）。多个键及其关联的值有序地放在一起就构成了文档。不同的编程语言对文档的表示方法不同，在JavaScript 中文档表示为：</p>
<p>{“greeting”:“hello,world”}</p>
<p>这个文档只有一个键“greeting”，对应的值为“hello,world”。多数情况下，文档比这个更复杂，它包含多个键/值对。例如：</p>
<p>{“greeting”:“hello,world”,“foo”: 3}</p>
<p>文档中的键/值对是有序的，下面的文档与上面的文档是完全不同的两个文档。</p>
<p>{“foo”: 3 ,“greeting”:“hello,world”}</p>
<p>文档中的值不仅可以是双引号中的字符串，也可以是其他的数据类型，例如，整型、布尔型等，也可以是另外一个文档，即文档可以嵌套。文档中的键类型只能是字符串。</p>
<h4 id="集合" class="article-heading"><a href="#集合" class="headerlink" title="集合"></a>集合<a class="article-anchor" href="#集合" aria-hidden="true"></a></h4><p>集合就是一组文档，类似于关系数据库中的表。集合是无模式的，集合中的文档可以是各式各样的。例如，<code>{“hello,word”:“Mike”}和{“foo”: 3}</code>，它们的键不同，值的类型也不同，但是它们可以存放在同一个集合中，也就是不同模式的文档都可以放在同一个集合中。既然集合中可以存放任何类型的文档，那么为什么还需要使用多个集合？这是因为所有文档都放在同一个集合中，无论对于开发者还是管理员，都很难对集合进行管理，而且这种情形下，对集合的查询等操作效率都不高。所以在实际使用中，往往将文档分类存放在不同的集合中，例如，对于网站的日志记录，可以根据日志的级别进行存储，Info级别日志存放在Info 集合中，Debug 级别日志存放在Debug 集合中，这样既方便了管理，也提供了查询性能。但是需要注意的是，这种对文档进行划分来分别存储并不是MongoDB 的强制要求，用户可以灵活选择。</p>
<p>可以使用“.”按照命名空间将集合划分为子集合。例如，对于一个博客系统，可能包括blog.user 和blog.article 两个子集合，这样划分只是让组织结构更好一些，blog 集合和blog.user、blog.article 没有任何关系。虽然子集合没有任何特殊的地方，但是使用子集合组织数据结构清晰，这也是MongoDB 推荐的方法。</p>
<h4 id="数据库" class="article-heading"><a href="#数据库" class="headerlink" title="数据库"></a>数据库<a class="article-anchor" href="#数据库" aria-hidden="true"></a></h4><p>MongoDB 中多个文档组成集合，多个集合组成数据库。一个MongoDB 实例可以承载多个数据库。它们之间可以看作相互独立，每个数据库都有独立的权限控制。在磁盘上，不同的数据库存放在不同的文件中。MongoDB 中存在以下系统数据库。</p>
<ul>
<li>Admin 数据库：一个权限数据库，如果创建用户的时候将该用户添加到admin 数据库中，那么该用户就自动继承了所有数据库的权限。</li>
<li>Local 数据库：这个数据库永远不会被负责，可以用来存储本地单台服务器的任意集合。</li>
<li>Config 数据库：当MongoDB 使用分片模式时，config 数据库在内部使用，用于保存分片的信息。</li>
</ul>
<h2 id="搭建-MongoDB" class="article-heading"><a href="#搭建-MongoDB" class="headerlink" title="搭建 MongoDB"></a>搭建 MongoDB<a class="article-anchor" href="#搭建-MongoDB" aria-hidden="true"></a></h2><h3 id="MongoDB-下载" class="article-heading"><a href="#MongoDB-下载" class="headerlink" title="MongoDB 下载"></a>MongoDB 下载<a class="article-anchor" href="#MongoDB-下载" aria-hidden="true"></a></h3><p>MongoDB提供了可用于32位和64位系统的预编译二进制包，你可以从MongoDB官网下载安装，MongoDB预编译二进制包下载地址：<a target="_blank" rel="noopener" href="http://www.mongodb.org/downloads">http://www.mongodb.org/downloads</a></p>
<h3 id="MongoDB-搭建简单的单机服务" class="article-heading"><a href="#MongoDB-搭建简单的单机服务" class="headerlink" title="MongoDB 搭建简单的单机服务"></a>MongoDB 搭建简单的单机服务<a class="article-anchor" href="#MongoDB-搭建简单的单机服务" aria-hidden="true"></a></h3><h4 id="实验环境为rhel7-5-mongodb-4-0-0" class="article-heading"><a href="#实验环境为rhel7-5-mongodb-4-0-0" class="headerlink" title="实验环境为rhel7.5 mongodb 4.0.0"></a>实验环境为rhel7.5 mongodb 4.0.0<a class="article-anchor" href="#实验环境为rhel7-5-mongodb-4-0-0" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Intall Mongodb 4.0.0 Single</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2018-07-04</span></span><br><span class="line">SRC_URI="https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.0.0.tgz"</span><br><span class="line">PKG_NAME=`basename $SRC_URI`</span><br><span class="line">DIR=`pwd`</span><br><span class="line">DATE=`date +%Y%m%d%H%M%S`</span><br><span class="line">port=27017</span><br><span class="line">\mv /alidata/mongodb /alidata/mongodb.bak.$DATE &amp;&gt; /dev/null</span><br><span class="line">mkdir /alidata/{mongodb,install}</span><br><span class="line">mkdir /alidata/mongodb/{data,log,conf}</span><br><span class="line">mkdir /alidata/mongodb/data/$port</span><br><span class="line">cd /alidata/install</span><br><span class="line">if [ ! -s $PKG_NAME ]; then</span><br><span class="line">  wget -c $SRC_URI</span><br><span class="line">fi</span><br><span class="line">tar -xf mongodb-linux-x86_64-rhel70-4.0.0.tgz</span><br><span class="line">mv mongodb-linux-x86_64-rhel70-4.0.0/* /alidata/mongodb</span><br><span class="line">rm -rf mongodb-linux-x86_64-rhel70-4.0.0</span><br><span class="line">if ! cat /etc/profile | grep 'export PATH=$PATH:/alidata/mongodb/bin' &amp;&gt; /dev/null;then</span><br><span class="line">	echo 'export PATH=$PATH:/alidata/mongodb/bin' &gt;&gt; /etc/profile</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调整内核参数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1. 内核参数/sys/kernel/mm/transparent_hugepage/enabled</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2. 内核参数/sys/kernel/mm/transparent_hugepage/defrag</span></span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建单实例配置文件</span></span><br><span class="line">cat &gt; /alidata/mongodb/conf/mongodb${port}.conf &lt;&lt; EOT</span><br><span class="line">systemLog:</span><br><span class="line"> destination: file</span><br><span class="line"> path: /alidata/mongodb/log/mongod${port}.log</span><br><span class="line"> logAppend: true</span><br><span class="line">storage:</span><br><span class="line"> journal:</span><br><span class="line">  enabled: true</span><br><span class="line"> dbPath: /alidata/mongodb/data/${port}</span><br><span class="line"> directoryPerDB: true</span><br><span class="line"> engine: wiredTiger</span><br><span class="line"> wiredTiger:</span><br><span class="line">  engineConfig:</span><br><span class="line">   cacheSizeGB: 10</span><br><span class="line">   directoryForIndexes: true</span><br><span class="line">  collectionConfig:</span><br><span class="line">   blockCompressor: zlib</span><br><span class="line">  indexConfig:</span><br><span class="line">   prefixCompression: true</span><br><span class="line">net:</span><br><span class="line"> port: ${port}</span><br><span class="line">EOT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务启动脚本</span></span><br><span class="line">cat &gt; /alidata/mongodb/mongodb.server &lt;&lt; ENDF</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">start(){</span><br><span class="line">/alidata/mongodb/bin/mongod --config /alidata/mongodb/conf/mongodb\${port}.conf &amp;</span><br><span class="line">}</span><br><span class="line">stop(){</span><br><span class="line">/alidata/mongodb/bin/mongod --config /alidata/mongodb/conf/mongodb\${port}.conf --shutdown</span><br><span class="line">}</span><br><span class="line">case \$1 in</span><br><span class="line">start)</span><br><span class="line">start</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">stop</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">stop</span><br><span class="line">start</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">echo "Usage:\$0{start|stop|restart}"</span><br><span class="line">exit 1</span><br><span class="line">esac</span><br><span class="line">ENDF</span><br><span class="line"></span><br><span class="line">cd $DIR</span><br><span class="line">source /etc/profile</span><br><span class="line">bash</span><br></pre></td></tr></tbody></table></figure>

<h4 id="实验环境为rhel7-2-mongodb-3-4-1" class="article-heading"><a href="#实验环境为rhel7-2-mongodb-3-4-1" class="headerlink" title="实验环境为rhel7.2 mongodb 3.4.1"></a>实验环境为rhel7.2 mongodb 3.4.1<a class="article-anchor" href="#实验环境为rhel7-2-mongodb-3-4-1" aria-hidden="true"></a></h4><p>mastera 192.168.196.11</p>
<p>1.下载到本地并解压</p>
<p>安装指南可以查看压缩后的README</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera ~]# cd /tmp</span><br><span class="line">[root@mastera tmp]# ls</span><br><span class="line">mongodb-linux-x86_64-rhel70-3.4.1.tgz  mysql_scripts.zip</span><br><span class="line">[root@mastera tmp]# tar -xf mongodb-linux-x86_64-rhel70-3.4.1.tgz -C /usr/local/</span><br><span class="line">[root@mastera tmp]# cd /usr/local</span><br><span class="line">[root@mastera local]# ls</span><br><span class="line">bin  etc  games  include  lib  lib64  libexec  mongodb-linux-x86_64-rhel70-3.4.1  sbin  share  src</span><br><span class="line">[root@mastera local]# cd mongodb-linux-x86_64-rhel70-3.4.1/</span><br><span class="line">[root@mastera mongodb-linux-x86_64-rhel70-3.4.1]# ls</span><br><span class="line">bin  GNU-AGPL-3.0  MPL-2  README  THIRD-PARTY-NOTICES</span><br><span class="line">[root@mastera mongodb-linux-x86_64-rhel70-3.4.1]# ln -s /usr/local/mongodb-linux-x86_64-rhel70-3.4.1/ /usr/local/mongodb</span><br><span class="line">[root@mastera mongodb-linux-x86_64-rhel70-3.4.1]# cd /usr/local/mongodb</span><br><span class="line">[root@mastera mongodb]# pwd</span><br><span class="line">/usr/local/mongodb</span><br></pre></td></tr></tbody></table></figure>

<p>2.将可执行文件路径加入PATH变量中，并永久生效</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera mongodb]# echo "export PATH=$PATH:/usr/local/mongodb/bin" &gt;&gt; /etc/bashrc</span><br><span class="line">[root@mastera mongodb]# source /etc/bashrc</span><br><span class="line">[root@mastera mongodb]# ls bin</span><br><span class="line">bsondump  mongo  mongod  mongodump  mongoexport  mongofiles  mongoimport  mongooplog  mongoperf  mongoreplay  mongorestore  mongos  mongostat  mongotop</span><br><span class="line">[root@mastera mongodb]# which mongo</span><br><span class="line">/usr/local/mongodb/bin/mongo</span><br></pre></td></tr></tbody></table></figure>

<p>3.创建数据库目录和日志目录</p>
<p>MongoDB 默认的启动的数据库路径是 /data/db 。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera mongodb]# mkdir /mongodb/data/db -p</span><br><span class="line">[root@mastera mongodb]# mkdir /mongodb/data/log -p</span><br></pre></td></tr></tbody></table></figure>

<p>4.运行 MongoDB 服务</p>
<p>1)命令行参数运行 MongoDB 服务</p>
<p>可以在命令行中执行mongo安装目录中的bin目录执行mongod命令来启动mongdb服务。</p>
<p>–dbpath 指定数据路径</p>
<p>–logpath 指定日志路径</p>
<p>–logappend 指定日志追加</p>
<p>–port 指定监听端口</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera mongodb]# mongod --dbpath /mongodb/data/db/ --logpath /mongodb/data/log/mongodb.log --logappend &amp;</span><br><span class="line">[1] 1714</span><br></pre></td></tr></tbody></table></figure>

<p>这里有四个警告</p>
<ol>
<li>访问权限问题</li>
<li>进程执行用户为root问题</li>
<li>内核参数/sys/kernel/mm/transparent_hugepage/enabled</li>
<li>内核参数/sys/kernel/mm/transparent_hugepage/defrag</li>
</ol>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera mongodb]# cat /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">[always] madvise never</span><br><span class="line">[root@mastera mongodb]# echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">[root@mastera mongodb]# cat /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">always madvise [never]</span><br><span class="line">[root@mastera mongodb]# echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">[root@mastera mongodb]# cat /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">always madvise [never]</span><br></pre></td></tr></tbody></table></figure>

<p>查看守护进程为mongod，监听端口为27017</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera mongodb]# ps -ef|grep mongo</span><br><span class="line">root       1714   1585  0 21:50 pts/0    00:00:00 mongod --dbpath /mongodb/data/db/ --logpath /mongodb/data/log/mongodb.log --logappend</span><br><span class="line">root       1736   1585  0 21:51 pts/0    00:00:00 grep --color=auto mongo</span><br><span class="line">[root@mastera mongodb]# netstat -luntp|grep mongo</span><br><span class="line">tcp        0      0 0.0.0.0:27017           0.0.0.0:*               LISTEN      1714/mongod</span><br></pre></td></tr></tbody></table></figure>

<p>2)配置文件启动 MongoDB 服务</p>
<p>新建配置文件存放路径/mongodb/mongodb.cnf</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera mongodb]# vim /mongodb/mongodb.cnf</span><br><span class="line">dbpath=/mongodb/data/db</span><br><span class="line">logpath=/mongodb/data/log/mongodb.log</span><br><span class="line">logappend=true</span><br><span class="line">port=27017</span><br><span class="line">[root@mastera mongodb]# mongod -f /mongodb/mongodb.cnf &amp;</span><br><span class="line">[1] 1762</span><br><span class="line">[root@mastera mongodb]# ps -ef|grep mongo</span><br><span class="line">root       1762   1585  1 22:00 pts/0    00:00:00 mongod -f /mongodb/mongodb.cnf</span><br><span class="line">root       1780   1585  0 22:00 pts/0    00:00:00 grep --color=auto mongo</span><br><span class="line">[root@mastera mongodb]# netstat -luntp|grep mongo</span><br><span class="line">tcp        0      0 0.0.0.0:27017           0.0.0.0:*               LISTEN      1762/mongod</span><br></pre></td></tr></tbody></table></figure>

<p>5.MongoDB后台管理 Shell</p>
<p>如果你需要进入MongoDB后台管理，你需要先打开mongodb装目录的下的bin目录，然后执行mongo命令文件。</p>
<p>MongoDB Shell是MongoDB自带的交互式Javascript shell,用来对MongoDB进行操作和管理的交互式环境。</p>
<p>当你进入mongoDB后台后，它默认会链接到 test 文档（数据库）：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera mongodb]# mongo</span><br><span class="line">MongoDB shell version v3.4.1</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.1</span><br><span class="line">Welcome to the MongoDB shell.</span><br><span class="line">For interactive help, type "help".</span><br><span class="line">For more comprehensive documentation, see</span><br><span class="line">	http://docs.mongodb.org/</span><br><span class="line">Questions? Try the support group</span><br><span class="line">	http://groups.google.com/group/mongodb-user</span><br><span class="line">Server has startup warnings:</span><br><span class="line">2017-01-16T22:00:11.868+0800 I CONTROL  [initandlisten]</span><br><span class="line">2017-01-16T22:00:11.868+0800 I CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.</span><br><span class="line">2017-01-16T22:00:11.868+0800 I CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.</span><br><span class="line">2017-01-16T22:00:11.868+0800 I CONTROL  [initandlisten] ** WARNING: You are running this process as the root user, which is not recommended.</span><br><span class="line">2017-01-16T22:00:11.868+0800 I CONTROL  [initandlisten]</span><br></pre></td></tr></tbody></table></figure>

<p>由于它是一个JavaScript shell，您可以运行一些简单的算术运算:</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">2+2</span></span><br><span class="line">4</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">3*9</span></span><br><span class="line">27</span><br></pre></td></tr></tbody></table></figure>

<p>可以输入help获取帮助</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">help</span></span></span><br><span class="line">	db.help()                    help on db methods</span><br><span class="line">	db.mycoll.help()             help on collection methods</span><br><span class="line">	sh.help()                    sharding helpers</span><br><span class="line">	rs.help()                    replica set helpers</span><br><span class="line">	help admin                   administrative help</span><br><span class="line">	help connect                 connecting to a db help</span><br><span class="line">	help keys                    key shortcuts</span><br><span class="line">	help misc                    misc things to know</span><br><span class="line">	help mr                      mapreduce</span><br><span class="line"></span><br><span class="line">	show dbs                     show database names</span><br><span class="line">	show collections             show collections in current database</span><br><span class="line">	show users                   show users in current database</span><br><span class="line">	show profile                 show most recent system.profile entries with time &gt;= 1ms</span><br><span class="line">	show logs                    show the accessible logger names</span><br><span class="line">	show log [name]              prints out the last segment of log in memory, 'global' is default</span><br><span class="line">	use &lt;db_name&gt;                set current database</span><br><span class="line">	db.foo.find()                list objects in collection foo</span><br><span class="line">	db.foo.find( { a : 1 } )     list objects in foo where a == 1</span><br><span class="line">	it                           result of the last line evaluated; use to further iterate</span><br><span class="line">	DBQuery.shellBatchSize = x   set default number of items to display on shell</span><br><span class="line">	exit                         quit the mongo shell</span><br></pre></td></tr></tbody></table></figure>

<p>现在让我们插入一些简单的数据，并对插入的数据进行检索：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.runoob.insert({x:10})</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.runoob.find()</span></span><br><span class="line">{ "_id" : ObjectId("587cd2d4ba6fb83076d228f0"), "x" : 10 }</span><br></pre></td></tr></tbody></table></figure>

<p>第一个命令将数字 10 插入到 runoob 集合的 x 字段中。</p>
<p>6.MongoDb web 用户界面</p>
<blockquote>
<p>3.2 版后已移除:&nbsp;HTTP interface for MongoDB [<a target="_blank" rel="noopener" href="http://www.mongoing.com/docs/administration/monitoring.html]">http://www.mongoing.com/docs/administration/monitoring.html]</a></p>
</blockquote>
<p>MongoDB 提供了简单的 HTTP 用户界面。 如果你想启用该功能，需要在启动的时候指定参数 –rest 。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@mastera mongodb]# mongod --dbpath /mongodb/data/db/ --logpath /mongodb/data/log/mongodb.log --logappend --rest &amp;</span><br><span class="line">2017-01-16T22:10:49.463+0800 I CONTROL  [main] ** WARNING: --rest is specified without --httpinterface,</span><br><span class="line">2017-01-16T22:10:49.464+0800 I CONTROL  [main] **          enabling http interface</span><br><span class="line">[root@mastera ~]# ps -ef|grep mongo</span><br><span class="line">root       1859   1585  2 22:10 pts/0    00:00:00 mongod --dbpath /mongodb/data/db/ --logpath /mongodb/data/log/mongodb.log --logappend --rest</span><br><span class="line">root       1880   1680  0 22:11 pts/1    00:00:00 grep --color=auto mongo</span><br><span class="line">[root@mastera ~]# netstat -luntp|grep mongo</span><br><span class="line">tcp        0      0 0.0.0.0:27017           0.0.0.0:*               LISTEN      1859/mongod</span><br><span class="line">tcp        0      0 0.0.0.0:28017           0.0.0.0:*               LISTEN      1859/mongod</span><br></pre></td></tr></tbody></table></figure>

<p>MongoDB 的 Web 界面访问端口比服务的端口多1000。</p>
<p>如果你的MongoDB运行端口使用默认的27017，你可以在端口号为28017访问web用户界面，即地址为：<a target="_blank" rel="noopener" href="http://localhost:28017/">http://localhost:28017</a></p>
<p><img src="pic/02.jpg" alt="02"></p>
<h3 id="MongoDB-安全配置策略" class="article-heading"><a href="#MongoDB-安全配置策略" class="headerlink" title="MongoDB 安全配置策略"></a>MongoDB 安全配置策略<a class="article-anchor" href="#MongoDB-安全配置策略" aria-hidden="true"></a></h3><p>MongoDB黑客赎金事件始末</p>
<p>2015年底，有专家指出至少35000万个MongoDB数据库暴露在互联网上，近684.8T的数据在裸奔。据统计，今年1月Shodan上暴露在公网的MongoDB数据库多达47000个。著名安全专家John Matherly观察，不安全数据在以可怕的速度增加，从2015年7月到12月，短短四个月的时间不安全数据库实例增加了5000。Matherly在2015年就提出了这些裸露数据存在着巨大风险的论述。</p>
<p>果不其然，2016年12月27日，GDI Foundation 的安全研究人员 Victor Gevers首次发现了攻击者利用配置存在纰漏的开源数据库MongoDB展开了勒索行为。自称Harak1r1 的黑客组织将网络上公开的MongoDB资料库中的资料汇出，并将MongoDB服务器上的资料移除，然后向数据库所有人索取0.2个比特币(约208美元)的赎金。据悉，Harak1r1在短短几天的时间内攻击了2000多个MongoDB数据库，并有十多个所有人已支付赎金。</p>
<p>Harak1r1的攻击行为似乎点燃了黑客的攻击本能，众多鬣狗一下子围了上来，own3d(干掉了近千个数据库，赎金金额为0.5个比特币)、0704341626asdf(据统计干掉了至少740个数据库，赎金金额为0.15个比特币)、kraken0、3lix1r(这两个为后来者，但攻击速度不容小觑)。目前，MongoDB黑客攻击事件已经是一场大乱斗了，甚至还出现了黑客篡改其它黑客勒索信的情况。</p>
<p>默认Mongodb启动后任何机器都能通过默认端口连接上，非常危险，如果来个恶意分子把你数据给remove那就哭死吧，所以接下来说说Mongodb的安全配置。</p>
<h4 id="Security-Checklist" class="article-heading"><a href="#Security-Checklist" class="headerlink" title="Security Checklist"></a>Security Checklist<a class="article-anchor" href="#Security-Checklist" aria-hidden="true"></a></h4><ul>
<li><input disabled="" type="checkbox"> Enable Access Control and Enforce Authentication</li>
<li><input disabled="" type="checkbox"> Configure Role-Based Access Control</li>
<li><input disabled="" type="checkbox"> Encrypt Communication</li>
<li><input disabled="" type="checkbox"> Encrypt and Protect Data</li>
<li><input disabled="" type="checkbox"> Limit Network Exposure</li>
<li><input disabled="" type="checkbox"> Audit System Activity</li>
<li><input disabled="" type="checkbox"> Run MongoDB with a Dedicated User</li>
<li><input disabled="" type="checkbox"> Run MongoDB with Secure Configuration Options</li>
<li><input disabled="" type="checkbox"> Request a Security Technical Implementation Guide (where applicable)</li>
<li><input disabled="" type="checkbox"> Consider Security Standards Compliance</li>
</ul>
<p>安全检查列表如下：</p>
<ul>
<li><input disabled="" type="checkbox"> 启用访问控制和执行身份验证</li>
<li><input disabled="" type="checkbox"> 配置基于角色的访问控制</li>
<li><input disabled="" type="checkbox"> 加密通信</li>
<li><input disabled="" type="checkbox"> 加密和保护数据</li>
<li><input disabled="" type="checkbox"> 限制网络曝光</li>
<li><input disabled="" type="checkbox"> 审计系统活动</li>
<li><input disabled="" type="checkbox"> 运行MongoDB使用专用的用户</li>
<li><input disabled="" type="checkbox"> 用安全运行MongoDB配置选项</li>
<li><input disabled="" type="checkbox"> 请求安全技术实现指南(如适用)</li>
<li><input disabled="" type="checkbox"> 考虑安全标准遵从性</li>
</ul>
<h4 id="认证和授权" class="article-heading"><a href="#认证和授权" class="headerlink" title="认证和授权"></a>认证和授权<a class="article-anchor" href="#认证和授权" aria-hidden="true"></a></h4><p>虽然 <code>认证</code> 和 <code>授权</code> 关系非常紧密，认证和授权是两个不同的概念。认证是用来识别用户的身份，授权控制已经认证的用户使用资源和行为的权限。</p>
<p>MongoDB在默认的情况下启动时是没有用户名和密码的验证的，如果你需要使用密码验证功能，可以通过下面两种方式打开：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动mongodb时加上--auth</span></span><br><span class="line">sudo mongod --auth</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改/etc/mongodb.conf配置文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将auth = True这一行的注释去掉，保存文件，重启mongodb即可，而admin.system.users中保存了admin用户的信息。</span></span><br></pre></td></tr></tbody></table></figure>

<p>启动认证的一般流程：</p>
<p>1.不带访问控制的启动服务</p>
<p><code>mongod --dbpath /mongodb/data/db --logpath /mongodb/data/log/mongodb.log --logappend &amp;</code></p>
<p>2.连接实例</p>
<p><code>mongo --port 27017</code></p>
<p>3.创建超级账户</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use admin</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.createUser(</span></span><br><span class="line">  {</span><br><span class="line">    user: "myUserAdmin",</span><br><span class="line">    pwd: "abc123",</span><br><span class="line">    roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]</span><br><span class="line">  }</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>4.带访问控制重新启动实例</p>
<p><code>mongod --auth --dbpath--dbpath /mongodb/data/db --logpath /mongodb/data/log/mongodb.log --logappend &amp;</code></p>
<p>或者修改配置文件</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http://www.mongoing.com/docs/reference/configuration-options.html#security.authorization</span></span><br><span class="line">security:</span><br><span class="line">    authorization=enabled</span><br></pre></td></tr></tbody></table></figure>

<p>5.连接并认证超级账户</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第一种方法连接前认证——使用 -u -p --authenticationDatabase 参数|解释|</span></span><br><span class="line">mongo --port 27017 -u "myUserAdmin" -p "abc123" --authenticationDatabase "admin"</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第二种方法连接后认证，在mongo shell中使用 db.auth(&lt;username&gt;</span></span><br><span class="line">mongo --port 27017</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use admin</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.auth(<span class="string">"myUserAdmin"</span>, <span class="string">"abc123"</span> )</span></span><br></pre></td></tr></tbody></table></figure>

<p>6.根据开发要求创建其他用户</p>
<p>一旦成功认证了超级用户，就可以通过<code>db.createUser() </code>命令以及<code>内置或者用户自定义的角色（权限）</code>来创建其他用户</p>
<p>而<code>myUserAdmin</code>用户的权限只能管理用户和角色（权限）</p>
<p>接下来我们创建一个新用户<code>myTest</code>用户给<code>test</code>数据库，并且对<code>test</code>数据库拥有读写权限<code>readWrite role</code>，对<code>reporting</code>数据库有读的权限<code>read role</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">use test</span><br><span class="line">db.createUser(</span><br><span class="line">  {</span><br><span class="line">    user: "myTester",</span><br><span class="line">    pwd: "xyz123",</span><br><span class="line">    roles: [ { role: "readWrite", db: "test" },</span><br><span class="line">             { role: "read", db: "reporting" } ]</span><br><span class="line">  }</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<ol start="7">
<li>用myTester用户连接和认证</li>
</ol>
<p>在连接前认证</p>
<p>Start a mongo shell with the -u <username>, -p <password>, and the –authenticationDatabase <database> command line options:</database></password></username></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">mongo --port 27017 -u "myTester" -p "xyz123" --authenticationDatabase "test"</span><br></pre></td></tr></tbody></table></figure>

<p>在连接后认证</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连接</span></span><br><span class="line">mongo --port 27017</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">认证</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use <span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.auth(<span class="string">"myTester"</span>, <span class="string">"xyz123"</span> )</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">插入一个集合</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.foo.insert( { x: 1, y: 1 } )</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看reporting数据库的集合信息</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use reporting</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.a.find()</span></span><br></pre></td></tr></tbody></table></figure>

<p>MongoDB中的用户分为超级用户(super user)和普通的数据库用户(database user)：</p>
<ul>
<li>超级用户存放在admin数据库中(在MongoDB的初始情况下，admin数据库默认是空的)，这种用户拥有最大权限，可以对所有数据库进行任意操作；</li>
<li>数据库用户则是存放在另外的数据库中，这种用户只能访问自己的数据库。所有的用户信息都存放在自己数据库的system.users表中。</li>
</ul>
<p>在MongoDB中创建用户非常简单，如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建Admin用户</span></span><br><span class="line">mongo</span><br><span class="line">use admin</span><br><span class="line">db.createUser('super', '123456')</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建普通用户</span></span><br><span class="line">mongo</span><br><span class="line">use test</span><br><span class="line">db.createUser('test_user', '123456')</span><br></pre></td></tr></tbody></table></figure>

<p>具体的方法见MongoDB官方文档：add mongodb user</p>
<p>在MongoDB中，用户和权限有以下特性：</p>
<pre><code>1. 数据库是由超级用户来创建的，一个数据库可以包含多个用户，一个用户只能在一个数据库下，不同数据库中的用户可以同名；
2. 如果在 admin 数据库中不存在用户，即使 mongod 启动时添加了 --auth参数，此时不进行任何认证还是可以做任何操作；
3. 在 admin 数据库创建的用户具有超级权限，可以对 MongoDB 系统内的任何数据库的数据对象进行操作；
4. 特定数据库比如 test1 下的用户 test_user1，不能够访问其他数据库 test2，但是可以访问本数据库下其他用户创建的数据；
5. 不同数据库中同名的用户不能够登录其他数据库。比如数据库 test1 和 test2 都有用户 test_user，以 test_user 登录 test1 后,不能够登录到 test2 进行数据库操作
</code></pre>
<p>删除用户的操作如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use <span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.system.users.remove({user:<span class="string">"myTester"</span>})</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="限制访问IP和端口" class="article-heading"><a href="#限制访问IP和端口" class="headerlink" title="限制访问IP和端口"></a>限制访问IP和端口<a class="article-anchor" href="#限制访问IP和端口" aria-hidden="true"></a></h4><p>MongoDB可以限制只允许某一特定IP来访问，只要在启动时加一个参数bind_ip即可，或者在/etc/mongodb.conf中添加bind_ip配置，如下:</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方法一</span></span><br><span class="line">mongod ‐‐bind_ip 127.0.0.1,10.0.133.14</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方法二</span></span><br><span class="line">在/etc/mongodb.conf文件中添加以下内容：</span><br><span class="line">bind_ip = 127.0.0.1,10.0.133.14</span><br></pre></td></tr></tbody></table></figure>

<p>这样之后，MongoDB服务端只有127.0.0.1和10.0.133.14这两个 IP 可以访问了。</p>
<p>MongoDB默认的监听端口是27017，为了安全起见，你可以修改这个监听端口，避免恶意的连接尝试。修改方法同样有两种，如下：</p>
<p>客户端访问时不指定端口会连接到默认端口27017。当你修改了MongoDB服务端的端口后，客户端连接MongoDB时需要指定端口号，如：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方法一</span></span><br><span class="line">mongod --bind_ip 127.0.0.1,10.0.133.14 --port 28018</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方法二</span></span><br><span class="line">在/etc/mongodb.conf文件中添加以下内容：</span><br><span class="line">port = 28018</span><br><span class="line"></span><br><span class="line">mongo 10.0.133.14:28018</span><br></pre></td></tr></tbody></table></figure>

<h3 id="MongoDB-配置文件详解" class="article-heading"><a href="#MongoDB-配置文件详解" class="headerlink" title="MongoDB 配置文件详解"></a>MongoDB 配置文件详解<a class="article-anchor" href="#MongoDB-配置文件详解" aria-hidden="true"></a></h3><h4 id="系统日志systemLog-Options" class="article-heading"><a href="#系统日志systemLog-Options" class="headerlink" title="系统日志systemLog Options"></a>系统日志systemLog Options<a class="article-anchor" href="#系统日志systemLog-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">   verbosity: &lt;int&gt;    #在3.0版更改，详细级别决定了MongoDB输出的信息量和调试量，默认为0</span><br><span class="line">   quiet: &lt;boolean&gt;    #静默模式，不推荐生产使用，不利于排查问题</span><br><span class="line">   traceAllExceptions: &lt;boolean&gt;    #打印详细的调试信息。使用其他日志记录进行支持相关的故障排除。</span><br><span class="line">   syslogFacility: &lt;string&gt;    #将消息记录到系统日志时使用的设施级别。</span><br><span class="line">   path: &lt;string&gt;    #mongod或mongos应发送所有诊断日志信息的日志文件的路径，在指定的路径上创建日志文件</span><br><span class="line">   logAppend: &lt;boolean&gt;    #为true，则在mongos或mongod 实例重新启动时将新条目附加到现有日志文件的末尾</span><br><span class="line">   logRotate: &lt;string&gt;    #3.0.0新版功能，三个选项 rename,reopen,logAppend必须为true</span><br><span class="line">   destination: &lt;string&gt;    #MongoDB发送所有日志输出的目的地两个选项：file or syslog</span><br><span class="line">   timeStampFormat: &lt;string&gt; #Default: iso8601-local 1969-12-31T19:00:00.000-0500</span><br><span class="line">   component:</span><br><span class="line">      accessControl:</span><br><span class="line">         verbosity: &lt;int&gt;</span><br><span class="line">      command:</span><br><span class="line">         verbosity: &lt;int&gt;</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">systemLog:</span><br><span class="line">   destination: file</span><br><span class="line">   path: "/alidata/mongodb/log/mongod_22001.log"</span><br><span class="line">   logAppend: true</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>verbosity:</p>
<p>详细级别的范围可以从0到5：</p>
<p>0是MongoDB默认的日志详细级别，包含 信息性消息。</p>
<p>1到 5增加了详细级别以包含 调试消息。</p>
<p>参考地址：<a target="_blank" rel="noopener" href="http://docs.mongoing.com/reference/log-messages.html#log-messages-configure-verbosity">http://docs.mongoing.com/reference/log-messages.html#log-messages-configure-verbosity</a></p>
<p>logRotate：</p>
<p>rename：重命名日志文件。<br>reopen：关闭并重新打开日志文件，遵循典型的Linux / Unix日志旋转行为。使用Linux / Unix的logrotate工具时要重新打开，以避免日志丢失。<br>reopen：则还必须将systemLog.logAppend设置为true。</p>
</blockquote>
<h4 id="进程管理processManagement-Options" class="article-heading"><a href="#进程管理processManagement-Options" class="headerlink" title="进程管理processManagement Options"></a>进程管理processManagement Options<a class="article-anchor" href="#进程管理processManagement-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">processManagement:</span><br><span class="line">   fork: &lt;boolean&gt;    #默认：False 启用在后台运行mongos或mongod进程的守护进程模式</span><br><span class="line">   pidFilePath: &lt;string&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="网络选项Net-Options" class="article-heading"><a href="#网络选项Net-Options" class="headerlink" title="网络选项Net&nbsp;Options"></a>网络选项Net&nbsp;Options<a class="article-anchor" href="#网络选项Net-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">net:</span><br><span class="line">   port: &lt;int&gt;    #默认：27017</span><br><span class="line">   bindIp: &lt;string&gt;    #4.0默认只允许本地访问。3.2默认允许所有。mongos或mongod绑定的IP地址，以侦听来自应用程序的连接要绑定到多个IP地址，请输入逗号分隔值列表。</span><br><span class="line">   maxIncomingConnections: &lt;int&gt;    #默认：65536。mongos或mongod可以接受的最大并发连接数。</span><br><span class="line">   wireObjectCheck: &lt;boolean&gt;    #默认值：True</span><br><span class="line">   ipv6: &lt;boolean&gt; #在版本3.0中删除。MongoDB 3.0和更高版本中，IPv6始终处于启用状态。</span><br><span class="line">   unixDomainSocket:</span><br><span class="line">      enabled: &lt;boolean&gt;</span><br><span class="line">      pathPrefix: &lt;string&gt;    #默认：/ tmp</span><br><span class="line">      filePermissions: &lt;int&gt;    #默认：0700 设置UNIX域套接字文件的权限 只适用于基于Unix的系统</span><br><span class="line">   http:</span><br><span class="line">      enabled: &lt;boolean&gt;    #Default: False 3.2 版后已移除</span><br><span class="line">      JSONPEnabled: &lt;boolean&gt;</span><br><span class="line">      RESTInterfaceEnabled: &lt;boolean&gt;</span><br><span class="line">   ssl:</span><br><span class="line">      sslOnNormalPorts: &lt;boolean&gt; # 2.6版后已移除。在3.0版本更改：大多数MongoDB发行版现在包含对TLS / SSL的支持</span><br><span class="line">      mode: &lt;string&gt;    #2.6 新版功能.</span><br><span class="line">      PEMKeyFile: &lt;string&gt;</span><br><span class="line">      PEMKeyPassword: &lt;string&gt;</span><br><span class="line">      clusterFile: &lt;string&gt;</span><br><span class="line">      clusterPassword: &lt;string&gt;</span><br><span class="line">      CAFile: &lt;string&gt;</span><br><span class="line">      CRLFile: &lt;string&gt;</span><br><span class="line">      allowConnectionsWithoutCertificates: &lt;boolean&gt;</span><br><span class="line">      allowInvalidCertificates: &lt;boolean&gt;</span><br><span class="line">      allowInvalidHostnames: &lt;boolean&gt;</span><br><span class="line">      disabledProtocols: &lt;string&gt;</span><br><span class="line">      FIPSMode: &lt;boolean&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="安全Security-Options" class="article-heading"><a href="#安全Security-Options" class="headerlink" title="安全Security&nbsp;Options"></a>安全Security&nbsp;Options<a class="article-anchor" href="#安全Security-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">security:</span><br><span class="line">  keyFile: &lt;string&gt;</span><br><span class="line">  clusterAuthMode: &lt;string&gt;    #2.6新版功能。</span><br><span class="line">  authorization: &lt;string&gt;    #默认：禁用 启用或禁用基于角色的访问控制（RBAC）来控制每个用户对数据库资源和操作的访问。</span><br><span class="line">  transitionToAuth: &lt;boolean&gt;    #默认：False 3.4 新版功能:</span><br><span class="line">  javascriptEnabled:  &lt;boolean&gt;    #默认值：True 启用或禁用服务器端JavaScript执行</span><br><span class="line">  redactClientLogData: &lt;boolean&gt;    #3.4新版功能：仅适用于MongoDB Enterprise。</span><br><span class="line">  sasl:</span><br><span class="line">     hostName: &lt;string&gt;</span><br><span class="line">     serviceName: &lt;string&gt;</span><br><span class="line">     saslauthdSocketPath: &lt;string&gt;</span><br><span class="line">  enableEncryption: &lt;boolean&gt;    #默认：False 3.2新版功能：为WiredTiger存储引擎启用加密 仅在MongoDB Enterprise中可用</span><br><span class="line">  encryptionCipherMode: &lt;string&gt;    #3.2新版功能 仅在MongoDB Enterprise中可用</span><br><span class="line">  encryptionKeyFile: &lt;string&gt;    #仅在MongoDB Enterprise中可用</span><br><span class="line">  kmip:</span><br><span class="line">     keyIdentifier: &lt;string&gt;    #3.2新版功能</span><br><span class="line">     rotateMasterKey: &lt;boolean&gt;</span><br><span class="line">     serverName: &lt;string&gt;</span><br><span class="line">     port: &lt;string&gt;</span><br><span class="line">     clientCertificateFile: &lt;string&gt;</span><br><span class="line">     clientCertificatePassword: &lt;string&gt;</span><br><span class="line">     serverCAFile: &lt;string&gt;</span><br><span class="line">  ldap:    #3.4新版功能：仅适用于MongoDB Enterprise。</span><br><span class="line">     servers: &lt;string&gt;</span><br><span class="line">     bind:</span><br><span class="line">        method: &lt;string&gt;</span><br><span class="line">        saslMechanism: &lt;string&gt;</span><br><span class="line">        queryUser: &lt;string&gt;</span><br><span class="line">        queryPassword: &lt;string&gt;</span><br><span class="line">        useOSDefaults: &lt;boolean&gt;    #3.4新版功能：仅适用于Windows平台的MongoDB Enterprise。</span><br><span class="line">     transportSecurity: &lt;string&gt;</span><br><span class="line">     timeoutMS: &lt;int&gt;</span><br><span class="line">     userToDNMapping: &lt;string&gt;</span><br><span class="line">     authz:</span><br><span class="line">        queryTemplate: &lt;string&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="参数设置setParameter-Option" class="article-heading"><a href="#参数设置setParameter-Option" class="headerlink" title="参数设置setParameter Option"></a>参数设置setParameter Option<a class="article-anchor" href="#参数设置setParameter-Option" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">setParameter:</span><br><span class="line">   &lt;parameter1&gt;: &lt;value1&gt;</span><br><span class="line">   &lt;parameter2&gt;: &lt;value2&gt;</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">setParameter:</span><br><span class="line">   enableLocalhostAuthBypass: false</span><br><span class="line">   ldapUserCacheInvalidationInterval: &lt;int&gt; #默认：30</span><br></pre></td></tr></tbody></table></figure>

<h4 id="存储Storage-Options" class="article-heading"><a href="#存储Storage-Options" class="headerlink" title="存储Storage Options"></a>存储Storage Options<a class="article-anchor" href="#存储Storage-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">storage:</span><br><span class="line">   dbPath: &lt;string&gt;    #缺省值：Linux和OS X上的/data/db，Windows上的\data\db</span><br><span class="line">   indexBuildRetry: &lt;boolean&gt;    #默认值：True mongod是否在下次启动时重建不完整的索引 不适用于使用内存存储引擎的mongod实例</span><br><span class="line">   repairPath: &lt;string&gt;</span><br><span class="line">   journal:</span><br><span class="line">      enabled: &lt;boolean&gt;    #Default: true on 64-bit systems, false on 32-bit systems</span><br><span class="line">      commitIntervalMs: &lt;num&gt; #默认值：100或30 3.2新版功能</span><br><span class="line">   directoryPerDB: &lt;boolean&gt;    #默认：False</span><br><span class="line">   syncPeriodSecs: &lt;int&gt;   #默认：60 不要在生产系统上设置这个值。在几乎所有情况下，您都应该使用默认设置。</span><br><span class="line">   engine: &lt;string&gt;    #在3.2版本更改：从MongoDB 3.2开始，wiredTiger是默认的</span><br><span class="line">   mmapv1:</span><br><span class="line">      preallocDataFiles: &lt;boolean&gt;    #默认值：True 2.6版后已移除</span><br><span class="line">      nsSize: &lt;int&gt;    #默认：16</span><br><span class="line">      quota:</span><br><span class="line">         enforced: &lt;boolean&gt;    #默认：false MongoDB每个数据库最多有8个数据文件 使用storage.quota.maxFilesPerDB调整配额 。</span><br><span class="line">         maxFilesPerDB: &lt;int&gt;    #默认：8</span><br><span class="line">      smallFiles: &lt;boolean&gt;    #默认：False</span><br><span class="line">      journal:</span><br><span class="line">         debugFlags: &lt;int&gt;    #类型：整数 提供测试功能</span><br><span class="line">         commitIntervalMs: &lt;num&gt;    #3.2版本已移除</span><br><span class="line">   wiredTiger:</span><br><span class="line">      engineConfig:</span><br><span class="line">         cacheSizeGB: &lt;number&gt;    #类型：float WiredTiger将用于所有数据的内部缓存的最大大小，控制的物理内存</span><br><span class="line">         #物理内存-wiredtiger-其他进程-系统所占用的内存=filesystem cache</span><br><span class="line">         journalCompressor: &lt;string&gt;    #默认：snappy 3.0.0新版功能</span><br><span class="line">         directoryForIndexes: &lt;boolean&gt;    #默认：false 3.0.0新版功能</span><br><span class="line">      collectionConfig:</span><br><span class="line">         blockCompressor: &lt;string&gt;    #默认：snappy</span><br><span class="line">      indexConfig:</span><br><span class="line">         prefixCompression: &lt;boolean&gt;    #默认值：true</span><br><span class="line">   inMemory:</span><br><span class="line">      engineConfig:</span><br><span class="line">         inMemorySizeGB: &lt;number&gt;    #默认值：物理RAM的50％少于1 GB 在3.4版本更改：数值可以从256MB到10TB，可以是一个浮点数 仅在MongoDB Enterprise中可用</span><br></pre></td></tr></tbody></table></figure>

<h4 id="OperationProfiling-Options" class="article-heading"><a href="#OperationProfiling-Options" class="headerlink" title="OperationProfiling Options"></a>OperationProfiling Options<a class="article-anchor" href="#OperationProfiling-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">operationProfiling:</span><br><span class="line">   slowOpThresholdMs: &lt;int&gt;    #默认值：100 数据库分析器认为查询的阈值（以毫秒为单位）变慢。</span><br><span class="line">   mode: &lt;string&gt;    #默认：关闭 数据库分析可能会影响数据库性能 off,slowOp,all</span><br></pre></td></tr></tbody></table></figure>

<h4 id="复制Replication-Options" class="article-heading"><a href="#复制Replication-Options" class="headerlink" title="复制Replication Options"></a>复制Replication Options<a class="article-anchor" href="#复制Replication-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">replication:</span><br><span class="line">   oplogSizeMB: &lt;int&gt;    #ype: integer 以兆字节为单位 对于64位系统，oplog通常是可用磁盘空间的5％</span><br><span class="line">   replSetName: &lt;string&gt;   #类型：字符串</span><br><span class="line">   secondaryIndexPrefetch: &lt;string&gt;    #默认：全部 仅在 mmapv1 存储引擎中可用 none,all,_id_only</span><br><span class="line">   enableMajorityReadConcern: &lt;boolean&gt;    #默认：False 3.2新版功能</span><br></pre></td></tr></tbody></table></figure>

<h4 id="集群分片sharding-Options" class="article-heading"><a href="#集群分片sharding-Options" class="headerlink" title="集群分片sharding&nbsp;Options"></a>集群分片sharding&nbsp;Options<a class="article-anchor" href="#集群分片sharding-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">sharding:</span><br><span class="line">   clusterRole: &lt;string&gt;    #configsvr 默认启动端口27019 shardsvr 默认启动端口27018</span><br><span class="line">   archiveMovedChunks: &lt;boolean&gt;    #3.2版本更改：从3.2开始，MongoDB 默认使用false 在块迁移期间，分片不保存从分片迁移的文档</span><br></pre></td></tr></tbody></table></figure>

<h4 id="检查日志AuditLog-Options" class="article-heading"><a href="#检查日志AuditLog-Options" class="headerlink" title="检查日志AuditLog&nbsp;Options"></a>检查日志AuditLog&nbsp;Options<a class="article-anchor" href="#检查日志AuditLog-Options" aria-hidden="true"></a></h4><blockquote>
<p>注解</p>
<p>Available only in&nbsp;<a target="_blank" rel="noopener" href="http://www.mongodb.com/products/mongodb-enterprise?jmp=docs">MongoDB Enterprise</a></p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">auditLog:</span><br><span class="line">   destination: &lt;string&gt;    #2.6 新版功能</span><br><span class="line">   format: &lt;string&gt;</span><br><span class="line">   path: &lt;string&gt;</span><br><span class="line">   filter: &lt;string&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="简单网络管理协议-snmp-Options" class="article-heading"><a href="#简单网络管理协议-snmp-Options" class="headerlink" title="简单网络管理协议 snmp&nbsp;Options"></a>简单网络管理协议 snmp&nbsp;Options<a class="article-anchor" href="#简单网络管理协议-snmp-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">snmp:</span><br><span class="line">   subagent: &lt;boolean&gt;</span><br><span class="line">   master: &lt;boolean&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Mongos-only-Options" class="article-heading"><a href="#Mongos-only-Options" class="headerlink" title="Mongos-only Options"></a>Mongos-only Options<a class="article-anchor" href="#Mongos-only-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">replication:</span><br><span class="line">   localPingThresholdMs: &lt;int&gt;    #Default: 15 以毫秒为单位</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">   configDB: &lt;string&gt; #从MongoDB 3.2开始，分片集群的配置服务器可以部署为一个副本集。副本集配置服务器必须运行WiredTiger存储引擎。MongoDB 3.2弃用配置服务器的三个镜像 mongod实例。</span><br><span class="line"></span><br><span class="line">eg：</span><br><span class="line">sharding：</span><br><span class="line">  configDB：&lt;configReplSetName&gt; /cfg1.example.net:27017，cfg2.example.net:27017，...</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Windows-Service-Options" class="article-heading"><a href="#Windows-Service-Options" class="headerlink" title="Windows Service Options"></a>Windows Service Options<a class="article-anchor" href="#Windows-Service-Options" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">processManagement:</span><br><span class="line">   windowsService:</span><br><span class="line">      serviceName: &lt;string&gt;    # default: MongoDB</span><br><span class="line">      displayName: &lt;string&gt;</span><br><span class="line">      description: &lt;string&gt;</span><br><span class="line">      serviceUser: &lt;string&gt;</span><br><span class="line">      servicePassword: &lt;string&gt;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="MongoDB-WT建议配置项" class="article-heading"><a href="#MongoDB-WT建议配置项" class="headerlink" title="MongoDB WT建议配置项"></a>MongoDB WT建议配置项<a class="article-anchor" href="#MongoDB-WT建议配置项" aria-hidden="true"></a></h3><h4 id="单实例配置" class="article-heading"><a href="#单实例配置" class="headerlink" title="单实例配置"></a>单实例配置<a class="article-anchor" href="#单实例配置" aria-hidden="true"></a></h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">systemLog:</span><br><span class="line"> destination: file</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##日志存储位置</span></span></span><br><span class="line"> path: /data/mongodb/log/mongod.log</span><br><span class="line"> logAppend: true</span><br><span class="line">storage:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#journal配置</span></span></span><br><span class="line"> journal:</span><br><span class="line">  enabled: true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#数据文件存储位置</span></span></span><br><span class="line"> dbPath: /data/zhou/mongo1/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#是否一个库一个文件夹</span></span></span><br><span class="line"> directoryPerDB: true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#数据引擎</span></span></span><br><span class="line"> engine: wiredTiger</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#WT引擎配置</span></span></span><br><span class="line"> wiredTiger:</span><br><span class="line">  engineConfig:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#WT最大使用cache（根据服务器实际情况调节）</span></span></span><br><span class="line">   cacheSizeGB: 10</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#是否将索引也按数据库名单独存储</span></span></span><br><span class="line">   directoryForIndexes: true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#表压缩配置</span></span></span><br><span class="line">  collectionConfig:</span><br><span class="line">   blockCompressor: zlib</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#索引配置</span></span></span><br><span class="line">  indexConfig:</span><br><span class="line">   prefixCompression: true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#端口配置</span></span></span><br><span class="line">net:</span><br><span class="line"> port: 27017</span><br></pre></td></tr></tbody></table></figure>

<h4 id="复制集配置" class="article-heading"><a href="#复制集配置" class="headerlink" title="复制集配置"></a>复制集配置<a class="article-anchor" href="#复制集配置" aria-hidden="true"></a></h4><p>（在上述配置上加入如下几个配置）：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">replication:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#oplog大小</span></span></span><br><span class="line"> oplogSizeMB: 20</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#复制集名称</span></span></span><br><span class="line"> replSetName: zhou1</span><br></pre></td></tr></tbody></table></figure>

<h4 id="分片集群配置" class="article-heading"><a href="#分片集群配置" class="headerlink" title="分片集群配置"></a>分片集群配置<a class="article-anchor" href="#分片集群配置" aria-hidden="true"></a></h4><p>分片复制集配置</p>
<p>（单实例节点的基础上）：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">replication:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#oplog大小</span></span></span><br><span class="line"> oplogSizeMB: 20</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#复制集名称</span></span></span><br><span class="line"> replSetName: zhou1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#分片配置</span></span></span><br><span class="line">sharding:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#分片角色</span></span></span><br><span class="line"> clusterRole: shardsvr</span><br></pre></td></tr></tbody></table></figure>

<h4 id="config-server配置" class="article-heading"><a href="#config-server配置" class="headerlink" title="config server配置"></a>config server配置<a class="article-anchor" href="#config-server配置" aria-hidden="true"></a></h4><p>（单实例节点的基础上）</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#分片配置</span></span></span><br><span class="line">sharding:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#分片角色</span></span></span><br><span class="line"> clusterRole: configsvr</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h4 id="Mongos配置" class="article-heading"><a href="#Mongos配置" class="headerlink" title="Mongos配置"></a>Mongos配置<a class="article-anchor" href="#Mongos配置" aria-hidden="true"></a></h4><p>（与单实例不同）：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#日志配置</span></span></span><br><span class="line">systemLog:</span><br><span class="line"> destination: file</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#日志位置</span></span></span><br><span class="line"> path: /data/mongos/mongod.log</span><br><span class="line"> logAppend: true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#网路配置</span></span></span><br><span class="line">net:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#端口配置</span></span></span><br><span class="line"> port: 29020</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#分片配置</span></span></span><br><span class="line">sharding:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#指定config server</span></span></span><br><span class="line"> configDB: 10.96.29.2:29017,10.96.29.2:29018,10.96.29.2:29019</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="MongoDB-搭建具有冗余容错功能的复制集" class="article-heading"><a href="#MongoDB-搭建具有冗余容错功能的复制集" class="headerlink" title="MongoDB 搭建具有冗余容错功能的复制集"></a>MongoDB 搭建具有冗余容错功能的复制集<a class="article-anchor" href="#MongoDB-搭建具有冗余容错功能的复制集" aria-hidden="true"></a></h3><p>主从复制是MongoDB最常用的复制方式。这种方式非常灵活，可用于备份、故障恢复、读拓展等。</p>
<p>复制集（replication set）是有自动故障恢复功能的主动集群。主从集群和复制集最为明显的区别在于，复制集没有固定的“主节点”。复制集总会有一个活跃节点primary和一个或多个备份节点secondary。</p>
<h4 id="搭建主从复制" class="article-heading"><a href="#搭建主从复制" class="headerlink" title="搭建主从复制"></a>搭建主从复制<a class="article-anchor" href="#搭建主从复制" aria-hidden="true"></a></h4><p>搭建主从可以在启动时通过参数设置，也可以在客户端交互界面下配置。</p>
<h5 id="参数配置" class="article-heading"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置<a class="article-anchor" href="#参数配置" aria-hidden="true"></a></h5><blockquote>
<p>通过参数搭建步骤</p>
</blockquote>
<ol>
<li>启动主服务器<code>mongod --master</code></li>
<li>启动从服务器<code>mongod --slave --source ip:port</code></li>
</ol>
<p>所有从节点都是从主节点复制内容。一个集群中有多少个从节点，并没有明确的限制，但是上千个也会可能吃不消，一般不超过12个就可以运转良好。</p>
<blockquote>
<p>参数解释</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">–only</td>
<td align="left">从节点指定只复制特定某个数据库</td>
</tr>
<tr>
<td align="left">–savedelay</td>
<td align="left">从节点应用主节点的操作时增加延时，单位s，认为误操作有重要的防护作用</td>
</tr>
<tr>
<td align="left">–fastsync</td>
<td align="left">以主节点的数据快照为基础启动从节点。快照比作完全同步速度快很多</td>
</tr>
<tr>
<td align="left">–autoresync</td>
<td align="left">如果从节点与主节点不同步了，则自动重新同步</td>
</tr>
<tr>
<td align="left">–oplogSize</td>
<td align="left">主节点oplog的大小，单位MB</td>
</tr>
</tbody></table>
<h5 id="客户端配置" class="article-heading"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置<a class="article-anchor" href="#客户端配置" aria-hidden="true"></a></h5><blockquote>
<p>客户端配置从机</p>
</blockquote>
<ol>
<li>启动mongod服务<code>mongod --slave</code></li>
<li>通过客户端程序mongo登陆服务</li>
<li>使用本地<code>&gt; use local</code></li>
<li>为从机添加源<code>&gt; db.sources.insert({"host" : "ip:port"})</code></li>
<li>查看从机的源<code>&gt; db.sources.find()</code></li>
<li>移除从机的源<code>&gt; db.sources.remove({"host" : "ip:port"})</code></li>
</ol>
<p>我们可以发现，sources集和可以被当作普通集合进行操作，而且为管理节点提供很大的灵活性。</p>
<h4 id="搭建复制集" class="article-heading"><a href="#搭建复制集" class="headerlink" title="搭建复制集"></a>搭建复制集<a class="article-anchor" href="#搭建复制集" aria-hidden="true"></a></h4><p>复制集最美妙的地方就是所有东西都是自动化的。</p>
<ol>
<li>自动提升备份节点成为活跃节点，以确保运转正常；</li>
<li>对于开发而言，也很易用，仅需要为复制集指定下服务器，驱动程序就会自动找到服务器，在当前活跃节点死机时自动处理故障恢复</li>
</ol>
<h4 id="实践1——搭建包含两台服务器的复制集" class="article-heading"><a href="#实践1——搭建包含两台服务器的复制集" class="headerlink" title="实践1——搭建包含两台服务器的复制集"></a>实践1——搭建包含两台服务器的复制集<a class="article-anchor" href="#实践1——搭建包含两台服务器的复制集" aria-hidden="true"></a></h4><p>1.命名复制集<code>booboo</code></p>
<p>2.复制集中服务器的主机名<code>hostname</code></p>
<p>3.启动复制集node1<code>mongod --dbpath /mongodb/data/node1 --port 10001 --replSet booboo/masterb:10002</code></p>
<p>4.启动复制集node2<code>mongod --dbpath /mongodb/data/node2 --port 10002 --replSet booboo/mastera:10001</code></p>
<p>5.添加集群节点node3</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">mongod --dbpath /mongodb/data/node3 --port 10003 --replSet booboo/mastera:10001</span><br><span class="line">mongod --dbpath /mongodb/data/node3 --port 10003 --replSet booboo/mastera:10001,masterb:10002</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">以上两种方法都行</span></span><br></pre></td></tr></tbody></table></figure>

<p>6.初始化复制集</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">连接一种一台服务器</span></span><br><span class="line">mongo mastera:10001/admin</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.runCommand({<span class="string">"replSetInitiate"</span> : {<span class="string">"_id"</span>: <span class="string">"booboo"</span>,<span class="string">"members"</span> : [{<span class="string">"_id"</span>:1,<span class="string">"host"</span>:<span class="string">"mastera:10001"</span>},{<span class="string">"_id"</span>:2,<span class="string">"host"</span>:<span class="string">"masterb"</span>:10002}]}})</span></span><br></pre></td></tr></tbody></table></figure>

<table>
<thead>
<tr>
<th align="left">初始化文档</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>"_id": "booboo"</code></td>
<td align="left">复制集的名字</td>
</tr>
<tr>
<td align="left"><code>"members" : [,]</code></td>
<td align="left">复制集中的服务器列表，之后还能添加，每个服务器文档至少要有两个</td>
</tr>
<tr>
<td align="left"><code>"_id"</code></td>
<td align="left">每个服务器的唯一ID</td>
</tr>
<tr>
<td align="left"><code>"hostname" : hostname</code></td>
<td align="left">这个key指定服务器主机名</td>
</tr>
</tbody></table>
<p>7.查看日志观察那个节点被选为primary活跃节点</p>
<p>8.查看官方最新的复制集文档 <a target="_blank" rel="noopener" href="https://www.mongodb.org/display/DOCS/Replica+Sets">https://www.mongodb.org/display/DOCS/Replica+Sets</a></p>
<h4 id="实践2——故障切换和活跃节点选举" class="article-heading"><a href="#实践2——故障切换和活跃节点选举" class="headerlink" title="实践2——故障切换和活跃节点选举"></a>实践2——故障切换和活跃节点选举<a class="article-anchor" href="#实践2——故障切换和活跃节点选举" aria-hidden="true"></a></h4><h3 id="MongoDB-搭建大规模数据集群" class="article-heading"><a href="#MongoDB-搭建大规模数据集群" class="headerlink" title="MongoDB 搭建大规模数据集群"></a>MongoDB 搭建大规模数据集群<a class="article-anchor" href="#MongoDB-搭建大规模数据集群" aria-hidden="true"></a></h3><h3 id="MongoDB-完成集群的自动部署" class="article-heading"><a href="#MongoDB-完成集群的自动部署" class="headerlink" title="MongoDB 完成集群的自动部署"></a>MongoDB 完成集群的自动部署<a class="article-anchor" href="#MongoDB-完成集群的自动部署" aria-hidden="true"></a></h3><h2 id="使用-MongoDB" class="article-heading"><a href="#使用-MongoDB" class="headerlink" title="使用 MongoDB"></a>使用 MongoDB<a class="article-anchor" href="#使用-MongoDB" aria-hidden="true"></a></h2><h3 id="mongo-shell" class="article-heading"><a href="#mongo-shell" class="headerlink" title="mongo shell"></a>mongo shell<a class="article-anchor" href="#mongo-shell" aria-hidden="true"></a></h3><blockquote>
<p>如果你不带任何参数运行 mongo ， mongo shell将尝试连接运行在<code>localhost</code>上端口号为<code>27017</code>的MongoDB实例。</p>
</blockquote>
<figure class="highlight plaintext"><figcaption><span>db]# mongo</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line">MongoDB shell version v3.4.1</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.1</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>输入<code>db</code>，显示你当前正在使用的数据库：</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">test</span><br></pre></td></tr></tbody></table></figure>

<p>此操作将返回默认数据库<code>test</code></p>
<blockquote>
<p>使用<code>show dbs</code>列出所有可用的数据库</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs</span></span><br><span class="line">admin  0.000GB</span><br><span class="line">local  0.000GB</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>要切换数据库，使用<code>use &lt;db&gt;</code>，如下例所示：</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use <span class="built_in">local</span></span></span><br><span class="line">switched to db local</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">local</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use admin</span></span><br><span class="line">switched to db admin</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">admin</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use <span class="built_in">test</span></span></span><br><span class="line">switched to db test</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">test</span><br></pre></td></tr></tbody></table></figure>

<h4 id="sql与mongodb术语对比" class="article-heading"><a href="#sql与mongodb术语对比" class="headerlink" title="sql与mongodb术语对比"></a>sql与mongodb术语对比<a class="article-anchor" href="#sql与mongodb术语对比" aria-hidden="true"></a></h4><table>
<thead>
<tr>
<th align="left">SQL术语/概念</th>
<th align="left">MongoDB术语/概念</th>
<th align="left">解释/说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">database</td>
<td align="left">database</td>
<td align="left">数据库</td>
</tr>
<tr>
<td align="left">table</td>
<td align="left">collection</td>
<td align="left">数据库表/集合</td>
</tr>
<tr>
<td align="left">row</td>
<td align="left">document</td>
<td align="left">数据记录行/文档</td>
</tr>
<tr>
<td align="left">column</td>
<td align="left">field</td>
<td align="left">数据字段/域</td>
</tr>
<tr>
<td align="left">index</td>
<td align="left">index</td>
<td align="left">索引</td>
</tr>
<tr>
<td align="left">table joins</td>
<td align="left"></td>
<td align="left">表连接,MongoDB不支持</td>
</tr>
<tr>
<td align="left">primary key</td>
<td align="left">primary key</td>
<td align="left">主键,MongoDB自动将_id字段设置为主键</td>
</tr>
</tbody></table>
<h4 id="数据库命名规范" class="article-heading"><a href="#数据库命名规范" class="headerlink" title="数据库命名规范"></a>数据库命名规范<a class="article-anchor" href="#数据库命名规范" aria-hidden="true"></a></h4><p>系统已存在的三个数据库：</p>
<ul>
<li>Admin 数据库：一个权限数据库，如果创建用户的时候将该用户添加到admin 数据库中，那么该用户就自动继承了所有数据库的权限。</li>
<li>Local 数据库：这个数据库永远不会被负责，可以用来存储本地单台服务器的任意集合。</li>
<li>Config 数据库：当MongoDB 使用分片模式时，config 数据库在内部使用，用于保存分片的信息。</li>
</ul>
<p>数据库也通过名字来标识。数据库名可以是满足以下条件的任意UTF-8字符串:</p>
<ul>
<li>不能是空字符串（””)。</li>
<li>不得含有’ ‘（空格)、.、$、/、\和\0 (空宇符)。</li>
<li>应全部小写。</li>
<li>最多64字节。</li>
</ul>
<h4 id="文档命名规范" class="article-heading"><a href="#文档命名规范" class="headerlink" title="文档命名规范"></a>文档命名规范<a class="article-anchor" href="#文档命名规范" aria-hidden="true"></a></h4><p>文档是一个键值(key-value)对(即BSON)。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。</p>
<p>一个简单的文档例子如下：<code>{"site":"www.uplooking.com", "name":"尚观科技"}</code></p>
<p>需要注意的是：</p>
<ol>
<li>文档中的键/值对是有序的。</li>
<li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</li>
<li>MongoDB区分类型和大小写。</li>
<li>MongoDB的文档不能有重复的键。</li>
<li>文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。</li>
</ol>
<p><strong>文档键命名规范</strong></p>
<ol>
<li>键不能含有\0 (空字符)。这个字符用来表示键的结尾。</li>
<li>“.”和”$”有特别的意义，只有在特定环境下才能使用。</li>
<li>以下划线”_“开头的键是保留的(不是严格要求的)。</li>
</ol>
<h4 id="集合命名规范" class="article-heading"><a href="#集合命名规范" class="headerlink" title="集合命名规范"></a>集合命名规范<a class="article-anchor" href="#集合命名规范" aria-hidden="true"></a></h4><p>集合就是 MongoDB 文档组，类似于 RDBMS （关系数据库管理系统：Relational Database Management System)中的表格。</p>
<p>集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据，但通常情况下我们插入集合的数据都会有一定的关联性。</p>
<p>比如，我们可以将以下不同数据结构的文档插入到集合中：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">{"site":"www.baidu.com"}</span><br><span class="line">{"site":"www.google.com","name":"Google"}</span><br><span class="line">{"site":"www.uplooking.com","name":"尚观科技","num":1}</span><br></pre></td></tr></tbody></table></figure>

<p>当第一个文档插入时，集合就会被创建。</p>
<p><strong>合法的集合名</strong></p>
<ol>
<li>集合名不能是空字符串””。</li>
<li>集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。</li>
<li>集合名不能以”system.”开头，这是为系统集合保留的前缀。</li>
<li>用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。</li>
</ol>
<p>　</p>
<h4 id="元数据" class="article-heading"><a href="#元数据" class="headerlink" title="元数据"></a>元数据<a class="article-anchor" href="#元数据" aria-hidden="true"></a></h4><p>数据库的信息是存储在集合中。它们使用了系统的命名空间：<code>dbname.system.*</code></p>
<p>在MongoDB数据库中名字空间 <dbname>.system.* 是包含多种系统信息的特殊集合(Collection)，如下:</dbname></p>
<table>
<thead>
<tr>
<th align="left">集合命名空间</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">dbname.system.namespaces</td>
<td align="left">列出所有名字空间。</td>
</tr>
<tr>
<td align="left">dbname.system.indexes</td>
<td align="left">列出所有索引。</td>
</tr>
<tr>
<td align="left">dbname.system.profile</td>
<td align="left">包含数据库概要(profile)信息。</td>
</tr>
<tr>
<td align="left">dbname.system.users</td>
<td align="left">列出所有可访问数据库的用户。</td>
</tr>
<tr>
<td align="left">dbname.local.sources</td>
<td align="left">包含复制对端（slave）的服务器信息和状态。</td>
</tr>
</tbody></table>
<p>对于修改系统集合中的对象有如下限制。</p>
<ul>
<li>在<code>{{system.indexes}}</code>插入数据，可以创建索引。但除此之外该表信息是不可变的(特殊的drop index命令将自动更新相关信息)。</li>
<li><code>{{system.users}}</code>是可修改的。</li>
<li><code>{{system.profile}}</code>是可删除的。</li>
</ul>
<h4 id="MongoDB-数据类型" class="article-heading"><a href="#MongoDB-数据类型" class="headerlink" title="MongoDB 数据类型"></a>MongoDB 数据类型<a class="article-anchor" href="#MongoDB-数据类型" aria-hidden="true"></a></h4><p>下表为MongoDB中常用的几种数据类型。</p>
<table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">String</td>
<td align="left">字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。</td>
</tr>
<tr>
<td align="left">Integer</td>
<td align="left">整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位。</td>
</tr>
<tr>
<td align="left">Boolean</td>
<td align="left">布尔值。用于存储布尔值（真/假）。</td>
</tr>
<tr>
<td align="left">Double</td>
<td align="left">双精度浮点值。用于存储浮点值。</td>
</tr>
<tr>
<td align="left">Min/Max keys</td>
<td align="left">将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比。</td>
</tr>
<tr>
<td align="left">Arrays</td>
<td align="left">用于将数组或列表或多个值存储为一个键。</td>
</tr>
<tr>
<td align="left">Timestamp</td>
<td align="left">时间戳。记录文档修改或添加的具体时间。</td>
</tr>
<tr>
<td align="left">Object</td>
<td align="left">用于内嵌文档。</td>
</tr>
<tr>
<td align="left">Null</td>
<td align="left">用于创建空值。</td>
</tr>
<tr>
<td align="left">Symbol</td>
<td align="left">符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言。</td>
</tr>
<tr>
<td align="left">Date</td>
<td align="left">日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息。</td>
</tr>
<tr>
<td align="left">Object ID</td>
<td align="left">对象 ID。用于创建文档的 ID。</td>
</tr>
<tr>
<td align="left">Binary Data</td>
<td align="left">二进制数据。用于存储二进制数据。</td>
</tr>
<tr>
<td align="left">Code</td>
<td align="left">代码类型。用于在文档中存储 JavaScript 代码。</td>
</tr>
<tr>
<td align="left">Regular expression</td>
<td align="left">正则表达式类型。用于存储正则表达式。</td>
</tr>
</tbody></table>
<h3 id="最基本的文档的读写更新删除-CRUD" class="article-heading"><a href="#最基本的文档的读写更新删除-CRUD" class="headerlink" title="最基本的文档的读写更新删除 CRUD"></a>最基本的文档的读写更新删除 CRUD<a class="article-anchor" href="#最基本的文档的读写更新删除-CRUD" aria-hidden="true"></a></h3><h4 id="创建数据库-use-dbname" class="article-heading"><a href="#创建数据库-use-dbname" class="headerlink" title="创建数据库 use dbname"></a>创建数据库 use dbname<a class="article-anchor" href="#创建数据库-use-dbname" aria-hidden="true"></a></h4><p>创建数据库的语法为：<code>use database_name</code></p>
<p>学过mysql的同学会认为只有数据库存在才能use，但是在mongodb中use后面的数据库不存在就会创建。</p>
<blockquote>
<p>课堂实战：创建数据库uplooking</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use uplooking</span></span><br><span class="line">switched to db uplooking</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">uplooking</span><br></pre></td></tr></tbody></table></figure>

<p>如果此时用<code>show dbs</code>查看所有的数据库会发现刚才创建的uplooking库并不存在，这是因为uplooking库中没有数据导致的。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs</span></span><br><span class="line">admin  0.000GB</span><br><span class="line">local  0.000GB</span><br></pre></td></tr></tbody></table></figure>

<h4 id="删除数据库-db-dropDatabase" class="article-heading"><a href="#删除数据库-db-dropDatabase" class="headerlink" title="删除数据库 db.dropDatabase()"></a>删除数据库 db.dropDatabase()<a class="article-anchor" href="#删除数据库-db-dropDatabase" aria-hidden="true"></a></h4><p>MongoDB 删除数据库的语法格式如下：<code>db.dropDatabase()</code></p>
<blockquote>
<p>课堂实战：创建数据库booboo，再删除booboo数据库</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use booboo</span></span><br><span class="line">switched to db booboo</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">booboo</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.dropDatabase()</span></span><br><span class="line">{ "ok" : 1 }</span><br></pre></td></tr></tbody></table></figure>

<h4 id="插入文档-insert" class="article-heading"><a href="#插入文档-insert" class="headerlink" title="插入文档 insert()"></a>插入文档 insert()<a class="article-anchor" href="#插入文档-insert" aria-hidden="true"></a></h4><p>MongoDB中提供了以下方法来插入文档到一个集合:</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">db.collection.insert()</span><br><span class="line">db.collection.insertOne() New in version 3.2</span><br><span class="line">db.collection.insertMany() New in version 3.2</span><br></pre></td></tr></tbody></table></figure>

<p>文档的数据结构和JSON基本一样。所有存储在集合中的数据都是BSON格式。</p>
<p>BSON是一种类json的一种二进制形式的存储格式,简称Binary JSON。</p>
<p>MongoDB 使用 insert() 或 save() 方法向集合中插入文档，语法如下：</p>
<p><code>db.COLLECTION_NAME.insert(document)</code></p>
<blockquote>
<p>课堂实战：向uplooking库中booboo集合中插入文档</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use uplooking</span></span><br><span class="line">switched to db uplooking</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({<span class="string">'title'</span>: <span class="string">'mongodb'</span>,</span></span><br><span class="line">... "description" : "mongodb is a nosql database",</span><br><span class="line">... "by" : "www.uplooking.com",</span><br><span class="line">... "tags" : [ "mongodb", "database", "nosql" ],</span><br><span class="line">... "likes" : 100})</span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br></pre></td></tr></tbody></table></figure>

<p>插入的时候，key可以不加引号，因为默认key的数据类型只能是字符串类型。</p>
<p>以上实例中 booboo 是我们的集合名，如果该集合不在该数据库中， MongoDB 会自动创建该集合并插入文档。</p>
<p>查看已插入文档：<code>db.COLLECTION_NAME.find()</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line">{ "_id" : ObjectId("58818af08fce77b49860b790"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br></pre></td></tr></tbody></table></figure>

<p>我们也可以将数据定义为一个变量，如下所示：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">document=({<span class="string">'title'</span>: <span class="string">'mongodb'</span>,</span></span><br><span class="line">... "description" : "mongodb is a nosql database",</span><br><span class="line">... "by" : "www.uplooking.com",</span><br><span class="line">... "tags" : [ "mongodb", "database", "nosql" ],</span><br><span class="line">... "likes" : 100})</span><br><span class="line">{</span><br><span class="line">	"title" : "mongodb",</span><br><span class="line">	"description" : "mongodb is a nosql database",</span><br><span class="line">	"by" : "www.uplooking.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database",</span><br><span class="line">		"nosql"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 100</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>执行插入操作：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert(document)</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br></pre></td></tr></tbody></table></figure>

<p>插入文档你也可以使用 <code>db.booboo.save(document)</code> 命令。如果不指定 <code>_id</code> 字段 <code>save()</code> 方法类似于 <code>insert()</code> 方法。如果指定 <code>_id</code> 字段，则会更新该 <code>_id</code> 的数据。</p>
<h4 id="更新文档-update-save" class="article-heading"><a href="#更新文档-update-save" class="headerlink" title="更新文档 update() save()"></a>更新文档 update() save()<a class="article-anchor" href="#更新文档-update-save" aria-hidden="true"></a></h4><p>MongoDB 使用 <code>update()</code> 和 <code>save()</code> 方法来更新集合中的文档。接下来让我们详细来看下两个函数的应用及其区别。</p>
<p><strong>update() 方法</strong></p>
<p>update() 方法用于更新已存在的文档。语法格式如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">db.collection.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   {</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   }</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>参数说明：</p>
<ul>
<li>query : update的查询条件，类似sql update查询内where后面的。</li>
<li>update : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的</li>
<li>upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。</li>
<li>multi : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。</li>
<li>writeConcern :可选，抛出异常的级别。</li>
</ul>
<p>实例</p>
<p>我们在集合 booboo 中的数据如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line">{ "_id" : ObjectId("58abae1bc7d333637aa4bb35"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abaea0c7d333637aa4bb36"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abaedfc7d333637aa4bb37"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br></pre></td></tr></tbody></table></figure>

<p>接着我们通过 update() 方法来更新标题(title):</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.update({<span class="string">"title"</span> : <span class="string">"mongodb"</span>},{<span class="variable">$set</span>:{<span class="string">"title"</span> : <span class="string">"MongoDB Learning"</span>}})</span></span><br><span class="line">WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line">{ "_id" : ObjectId("58abae1bc7d333637aa4bb35"), "title" : "MongoDB Learning", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abaea0c7d333637aa4bb36"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abaedfc7d333637aa4bb37"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到标题(title)由原来的 “MongoDB 教程” 更新为了 “MongoDB”。</p>
<p>以上语句只会修改第一条发现的文档，如果你要修改多条相同的文档，则需要设置 multi 参数为 true。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.update({<span class="string">"title"</span> : <span class="string">"mongodb"</span>},{<span class="variable">$set</span>:{<span class="string">"title"</span> : <span class="string">"MongoDB Learning"</span>}},{multi:<span class="literal">true</span>})</span></span><br><span class="line">WriteResult({ "nMatched" : 2, "nUpserted" : 0, "nModified" : 2 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line">{ "_id" : ObjectId("58abae1bc7d333637aa4bb35"), "title" : "MongoDB Learning", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abaea0c7d333637aa4bb36"), "title" : "MongoDB Learning", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abaedfc7d333637aa4bb37"), "title" : "MongoDB Learning", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br></pre></td></tr></tbody></table></figure>

<p><code>db.booboo.find().pretty()</code>美观的显示，可以自己试一下</p>
<p><strong>save() 方法</strong></p>
<p>save() 方法通过传入的文档来替换已有文档。语法格式如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">db.collection.save(</span><br><span class="line">   &lt;document&gt;,</span><br><span class="line">   {</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   }</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>参数说明：</p>
<ul>
<li>document : 文档数据。</li>
<li>writeConcern :可选，抛出异常的级别。</li>
</ul>
<p>实例</p>
<p>以下实例中我们替换了 “_id” : ObjectId(“58abae1bc7d333637aa4bb35”) 的文档数据：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.save({<span class="string">"_id"</span> : ObjectId(<span class="string">"58abae1bc7d333637aa4bb35"</span>), <span class="string">"title"</span> : <span class="string">"MongoDB Learning"</span>, <span class="string">"description"</span> : <span class="string">"mongodb is a nosql database"</span>, <span class="string">"by"</span> : <span class="string">"www.uplooking.com"</span>, <span class="string">"tags"</span> : [ <span class="string">"mongodb"</span>, <span class="string">"database"</span>, <span class="string">"nosql"</span> ], <span class="string">"likes"</span> : 100,<span class="string">'url'</span>:<span class="string">'http://www.uplooking.com'</span>})</span></span><br><span class="line">WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line">{ "_id" : ObjectId("58abae1bc7d333637aa4bb35"), "title" : "MongoDB Learning", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100, "url" : "http://www.uplooking.com" }</span><br><span class="line">{ "_id" : ObjectId("58abaea0c7d333637aa4bb36"), "title" : "MongoDB Learning", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abaedfc7d333637aa4bb37"), "title" : "MongoDB Learning", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br></pre></td></tr></tbody></table></figure>

<h4 id="删除文档-remove" class="article-heading"><a href="#删除文档-remove" class="headerlink" title="删除文档 remove()"></a>删除文档 remove()<a class="article-anchor" href="#删除文档-remove" aria-hidden="true"></a></h4><p>MongoDB remove()函数是用来移除集合中的数据。</p>
<p>MongoDB数据更新可以使用update()函数。在执行remove()函数前先执行find()命令来判断执行的条件是否正确，这是一个比较好的习惯。</p>
<p>语法</p>
<p>remove() 方法的基本语法格式如下所示：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">db.collection.remove(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;justOne&gt;</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>如果你的 MongoDB 是 2.6 版本以后的，语法格式如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">db.collection.remove(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   {</span><br><span class="line">     justOne: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   }</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>参数说明：</p>
<ul>
<li>query :（可选）删除的文档的条件。</li>
<li>justOne : （可选）如果设为 true 或 1，则只删除一个文档。</li>
<li>writeConcern :（可选）抛出异常的级别。</li>
</ul>
<p>实例</p>
<p>移除 title 为 ‘MongoDB Learning’ 的文档：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.remove({<span class="string">"title"</span> : <span class="string">"MongoDB Learning"</span>})</span></span><br><span class="line">WriteResult({ "nRemoved" : 3 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果你只想删除第一条找到的记录可以设置 justOne 为 1，如下所示：</p>
<p><code>db.COLLECTION_NAME.remove(DELETION_CRITERIA,1)</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({<span class="string">'title'</span>:<span class="string">'a'</span>,<span class="string">'likes'</span>:20})</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({<span class="string">'title'</span>:<span class="string">'a'</span>,<span class="string">'likes'</span>:30})</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({<span class="string">'title'</span>:<span class="string">'c'</span>,<span class="string">'likes'</span>:9})</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line">{ "_id" : ObjectId("58abb894c7d333637aa4bb38"), "title" : "a", "likes" : 20 }</span><br><span class="line">{ "_id" : ObjectId("58abb8b2c7d333637aa4bb39"), "title" : "a", "likes" : 30 }</span><br><span class="line">{ "_id" : ObjectId("58abb8b8c7d333637aa4bb3a"), "title" : "c", "likes" : 9 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.remove({<span class="string">"title"</span> : <span class="string">"a"</span>},1)</span></span><br><span class="line">WriteResult({ "nRemoved" : 1 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line">{ "_id" : ObjectId("58abb8b2c7d333637aa4bb39"), "title" : "a", "likes" : 30 }</span><br><span class="line">{ "_id" : ObjectId("58abb8b8c7d333637aa4bb3a"), "title" : "c", "likes" : 9 }</span><br></pre></td></tr></tbody></table></figure>

<p>如果你想删除所有数据，可以使用以下方式（类似常规 SQL 的 truncate 命令）：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.remove()</span></span><br><span class="line">2017-02-21T11:53:09.280+0800 E QUERY    [main] Error: remove needs a query :</span><br><span class="line">DBCollection.prototype._parseRemove@src/mongo/shell/collection.js:409:1</span><br><span class="line">DBCollection.prototype.remove@src/mongo/shell/collection.js:434:18</span><br><span class="line">@(shell):1:1</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.remove({})</span></span><br><span class="line">WriteResult({ "nRemoved" : 2 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br></pre></td></tr></tbody></table></figure>

<p>注意，db.booboo.remove()中一定写上”{}”，否则会报错哦！</p>
<h4 id="删除集合-drop" class="article-heading"><a href="#删除集合-drop" class="headerlink" title="删除集合 drop()"></a>删除集合 drop()<a class="article-anchor" href="#删除集合-drop" aria-hidden="true"></a></h4><p>集合删除语法格式如下：<code>db.collection.drop()</code></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs</span></span><br><span class="line">admin      0.000GB</span><br><span class="line">local      0.000GB</span><br><span class="line">uplooking  0.000GB</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">uplooking</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show collections</span></span><br><span class="line">booboo</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.drop()</span></span><br><span class="line">true</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show collections</span></span><br><span class="line"><span class="meta prompt_">&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="查询文档-find-pretty" class="article-heading"><a href="#查询文档-find-pretty" class="headerlink" title="查询文档 find() pretty()"></a>查询文档 find() pretty()<a class="article-anchor" href="#查询文档-find-pretty" aria-hidden="true"></a></h4><p>语法</p>
<p>MongoDB 查询数据的语法格式如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.COLLECTION_NAME.find()</span></span><br></pre></td></tr></tbody></table></figure>

<p>find() 方法以非结构化的方式来显示所有文档。</p>
<p>如果你需要以易读的方式来读取数据，可以使用 pretty() 方法，语法格式如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.booboo.find().pretty()</span></span><br></pre></td></tr></tbody></table></figure>

<p>pretty() 方法以格式化的方式来显示所有文档。</p>
<p>实例</p>
<p>以下实例我们查询了集合 booboo 中的数据：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({<span class="string">"title"</span> : <span class="string">"mongodb"</span>, <span class="string">"description"</span> : <span class="string">"mongodb is a nosql database"</span>, <span class="string">"by"</span> : <span class="string">"www.uplooking.com"</span>, <span class="string">"tags"</span> : [ <span class="string">"mongodb"</span>, <span class="string">"database"</span>, <span class="string">"nosql"</span> ], <span class="string">"likes"</span> : 100 })</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find().pretty()</span></span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abd086c7d333637aa4bb3b"),</span><br><span class="line">	"title" : "mongodb",</span><br><span class="line">	"description" : "mongodb is a nosql database",</span><br><span class="line">	"by" : "www.uplooking.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database",</span><br><span class="line">		"nosql"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 100</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>除了 find() 方法之外，还有一个 findOne() 方法，它只返回一个文档。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({<span class="string">"title"</span> : <span class="string">"mongodb"</span>, <span class="string">"description"</span> : <span class="string">"mongodb is a nosql database"</span>, <span class="string">"by"</span> : <span class="string">"www.uplooking.com"</span>, <span class="string">"tags"</span> : [ <span class="string">"mongodb"</span>, <span class="string">"database"</span>, <span class="string">"nosql"</span> ], <span class="string">"likes"</span> : 90 })</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.findOne()</span></span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abd086c7d333637aa4bb3b"),</span><br><span class="line">	"title" : "mongodb",</span><br><span class="line">	"description" : "mongodb is a nosql database",</span><br><span class="line">	"by" : "www.uplooking.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database",</span><br><span class="line">		"nosql"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 100</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<h4 id="MongoDB-与-RDBMS-Where-语句比较" class="article-heading"><a href="#MongoDB-与-RDBMS-Where-语句比较" class="headerlink" title="MongoDB 与 RDBMS Where 语句比较"></a>MongoDB 与 RDBMS Where 语句比较<a class="article-anchor" href="#MongoDB-与-RDBMS-Where-语句比较" aria-hidden="true"></a></h4></blockquote>
<p>如果你熟悉常规的 SQL 数据，通过下表可以更好的理解 MongoDB 的条件语句查询：</p>
<table>
<thead>
<tr>
<th align="left">操作</th>
<th align="left">格式</th>
<th align="left">范例</th>
<th align="left">RDBMS中的类似语句</th>
</tr>
</thead>
<tbody><tr>
<td align="left">等于</td>
<td align="left">{<key>:<value>}</value></key></td>
<td align="left">db.booboo.find({“by”:”<a target="_blank" rel="noopener" href="http://www.uplooking.com" }).pretty()="" "="">www.uplooking.com"}).pretty()</a></td>
<td align="left">where by = ‘<a target="_blank" rel="noopener" href="http://www.uplooking.com/">www.uplooking.com</a>‘</td>
</tr>
<tr>
<td align="left">小于</td>
<td align="left">{<key>:{$lt:<value>}}</value></key></td>
<td align="left">db.booboo.find({“likes”:{$lt:50}}).pretty()</td>
<td align="left">where likes &lt; 50</td>
</tr>
<tr>
<td align="left">小于或等于</td>
<td align="left">{<key>:{$lte:<value>}}</value></key></td>
<td align="left">db.booboo.find({“likes”:{$lte:50}}).pretty()</td>
<td align="left">where likes &lt;= 50</td>
</tr>
<tr>
<td align="left">大于</td>
<td align="left">{<key>:{$gt:<value>}}</value></key></td>
<td align="left">db.boobool.find({“likes”:{$gt:50}}).pretty()</td>
<td align="left">where likes &gt; 50</td>
</tr>
<tr>
<td align="left">大于或等于</td>
<td align="left">{<key>:{$gte:<value>}}</value></key></td>
<td align="left">db.booboo.find({“likes”:{$gte:50}}).pretty()</td>
<td align="left">where likes &gt;= 50</td>
</tr>
<tr>
<td align="left">不等于</td>
<td align="left">{<key>:{$ne:<value>}}</value></key></td>
<td align="left">db.booboo.find({“likes”:{$ne:50}}).pretty()</td>
<td align="left">where likes != 50</td>
</tr>
</tbody></table>
<blockquote>
<h4 id="MongoDB-AND-条件" class="article-heading"><a href="#MongoDB-AND-条件" class="headerlink" title="MongoDB AND 条件"></a>MongoDB AND 条件<a class="article-anchor" href="#MongoDB-AND-条件" aria-hidden="true"></a></h4></blockquote>
<p>MongoDB 的 find() 方法可以传入多个键(key)，每个键(key)以逗号隔开，及常规 SQL 的 AND 条件。</p>
<p>语法格式如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.booboo.find({key1:value1, key2:value2}).pretty()</span></span><br></pre></td></tr></tbody></table></figure>

<p>实例</p>
<p>以下实例查询键 by 值为 <a target="_blank" rel="noopener" href="http://www.uplooking.com/">www.uplooking.com</a> 和键 title 值为 mongodb 的数据</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'by'</span>:<span class="string">'www.uplooking.com'</span>,<span class="string">'title'</span>:<span class="string">'mongodb'</span>})</span></span><br><span class="line">{ "_id" : ObjectId("58abd086c7d333637aa4bb3b"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abd0cbc7d333637aa4bb3c"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 90 }</span><br></pre></td></tr></tbody></table></figure>

<p>以上实例中类似于 WHERE 语句：WHERE by=’<a target="_blank" rel="noopener" href="http://www.uplooking.com/">www.uplooking.com</a>‘ AND title=’mongodb’</p>
<blockquote>
<h4 id="MongoDB-OR-条件" class="article-heading"><a href="#MongoDB-OR-条件" class="headerlink" title="MongoDB OR 条件"></a>MongoDB OR 条件<a class="article-anchor" href="#MongoDB-OR-条件" aria-hidden="true"></a></h4></blockquote>
<p>MongoDB OR 条件语句使用了关键字 $or,语法格式如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.booboo.find(</span></span><br><span class="line">   {</span><br><span class="line">      $or: [</span><br><span class="line">	     {key1: value1}, {key2:value2}</span><br><span class="line">      ]</span><br><span class="line">   }</span><br><span class="line">).pretty()</span><br></pre></td></tr></tbody></table></figure>

<p>实例</p>
<p>以下实例中，我们演示了查询键 by 值为 <a target="_blank" rel="noopener" href="http://www.uplooking.com/">www.uplooking.com</a> 或键 title 值为 mongodb 的文档。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="variable">$or</span>:{<span class="string">'by'</span>:<span class="string">'www.uplooking.com'</span>,<span class="string">'title'</span>:<span class="string">'mongodb'</span>}}).pretty()</span></span><br><span class="line">Error: error: {</span><br><span class="line">	"ok" : 0,</span><br><span class="line">	"errmsg" : "$or must be an array",</span><br><span class="line">	"code" : 2,</span><br><span class="line">	"codeName" : "BadValue"</span><br><span class="line">}</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="variable">$or</span>:[{<span class="string">'by'</span>:<span class="string">'www.uplooking.com'</span>},{<span class="string">'title'</span>:<span class="string">'mongodb'</span>}]}).pretty()</span></span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abd086c7d333637aa4bb3b"),</span><br><span class="line">	"title" : "mongodb",</span><br><span class="line">	"description" : "mongodb is a nosql database",</span><br><span class="line">	"by" : "www.uplooking.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database",</span><br><span class="line">		"nosql"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 100</span><br><span class="line">}</span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abd0cbc7d333637aa4bb3c"),</span><br><span class="line">	"title" : "mongodb",</span><br><span class="line">	"description" : "mongodb is a nosql database",</span><br><span class="line">	"by" : "www.uplooking.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database",</span><br><span class="line">		"nosql"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 90</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<h4 id="AND-和-OR-联合使用" class="article-heading"><a href="#AND-和-OR-联合使用" class="headerlink" title="AND 和 OR 联合使用"></a>AND 和 OR 联合使用<a class="article-anchor" href="#AND-和-OR-联合使用" aria-hidden="true"></a></h4></blockquote>
<p>以下实例演示了 AND 和 OR 联合使用，类似常规 SQL 语句为： ‘where likes&gt;50 AND (by = ‘<a target="_blank" rel="noopener" href="http://www.uplooking.com/">www.uplooking.com</a>‘ OR title = ‘mongodb’)’</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'likes'</span>:{<span class="variable">$gt</span>:50},<span class="variable">$or</span>:[{<span class="string">'by'</span>:<span class="string">'www.uplooking.com'</span>},{<span class="string">'title'</span>:<span class="string">'mongodb'</span>}]})</span></span><br><span class="line">{ "_id" : ObjectId("58abd086c7d333637aa4bb3b"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abd0cbc7d333637aa4bb3c"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 90 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'likes'</span>:{<span class="variable">$gt</span>:50},<span class="variable">$or</span>:[{<span class="string">'by'</span>:<span class="string">'www.uplooking.com'</span>},{<span class="string">'title'</span>:<span class="string">'mongodb'</span>}]}).pretty()</span></span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abd086c7d333637aa4bb3b"),</span><br><span class="line">	"title" : "mongodb",</span><br><span class="line">	"description" : "mongodb is a nosql database",</span><br><span class="line">	"by" : "www.uplooking.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database",</span><br><span class="line">		"nosql"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 100</span><br><span class="line">}</span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abd0cbc7d333637aa4bb3c"),</span><br><span class="line">	"title" : "mongodb",</span><br><span class="line">	"description" : "mongodb is a nosql database",</span><br><span class="line">	"by" : "www.uplooking.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database",</span><br><span class="line">		"nosql"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 90</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="条件操作符" class="article-heading"><a href="#条件操作符" class="headerlink" title="条件操作符"></a>条件操作符<a class="article-anchor" href="#条件操作符" aria-hidden="true"></a></h4><p>MongoDB中条件操作符有：</p>
<p>(&gt;) 大于 - $gt</p>
<p>(&lt;) 小于 - $lt</p>
<p>(&gt;=) 大于等于 - $gte</p>
<p>(&lt;= ) 小于等于 - $lte</p>
<p>操作符在上一节中已经学习了基本语法，下面请完成相应练习：</p>
<p>使用数据库uplooking，集合booboo中已有数据如下所示：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line">{ "_id" : ObjectId("58abd086c7d333637aa4bb3b"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abd0cbc7d333637aa4bb3c"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 90 }</span><br><span class="line">{ "_id" : ObjectId("58abd66bc7d333637aa4bb3d"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 50 }</span><br><span class="line">{ "_id" : ObjectId("58abd66fc7d333637aa4bb3e"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 30 }</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>获取 “booboo” 集合中 “likes” 大于 50 的数据</li>
<li>获取 “booboo” 集合中 “likes” 小于 90 的数据</li>
<li>获取 “booboo” 集合中 “likes” 大于等于 50 的数据</li>
<li>获取 “booboo” 集合中 “likes” 小于等于 90 的数据</li>
<li>获取 “booboo” 集合中 “likes” 大于 50 小于 100 的数据</li>
<li>获取 “booboo” 集合中 “likes” 小于 50 或者 大于 90 的数据</li>
</ol>
<p>答案如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'likes'</span>:{<span class="variable">$gt</span>:50}})</span></span><br><span class="line">{ "_id" : ObjectId("58abd086c7d333637aa4bb3b"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abd0cbc7d333637aa4bb3c"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 90 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'likes'</span>:{<span class="variable">$lt</span>:90}})</span></span><br><span class="line">{ "_id" : ObjectId("58abd66bc7d333637aa4bb3d"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 50 }</span><br><span class="line">{ "_id" : ObjectId("58abd66fc7d333637aa4bb3e"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 30 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'likes'</span>:{<span class="variable">$gte</span>:50}})</span></span><br><span class="line">{ "_id" : ObjectId("58abd086c7d333637aa4bb3b"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abd0cbc7d333637aa4bb3c"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 90 }</span><br><span class="line">{ "_id" : ObjectId("58abd66bc7d333637aa4bb3d"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 50 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'likes'</span>:{<span class="variable">$lte</span>:90}})</span></span><br><span class="line">{ "_id" : ObjectId("58abd0cbc7d333637aa4bb3c"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 90 }</span><br><span class="line">{ "_id" : ObjectId("58abd66bc7d333637aa4bb3d"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 50 }</span><br><span class="line">{ "_id" : ObjectId("58abd66fc7d333637aa4bb3e"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 30 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'likes'</span>:{<span class="variable">$gt</span>:50,<span class="variable">$lt</span>:100}})</span></span><br><span class="line">{ "_id" : ObjectId("58abd0cbc7d333637aa4bb3c"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 90 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="variable">$or</span>:[{<span class="string">'likes'</span>:{<span class="variable">$gt</span>:90}},{<span class="string">'likes'</span>:{<span class="variable">$lt</span>:50}}]})</span></span><br><span class="line">{ "_id" : ObjectId("58abd086c7d333637aa4bb3b"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abd66fc7d333637aa4bb3e"), "title" : "mongodb", "description" : "mongodb is a nosql database", "by" : "www.uplooking.com", "tags" : [ "mongodb", "database", "nosql" ], "likes" : 30 }</span><br></pre></td></tr></tbody></table></figure>

<h4 id="type操作符和数据类型" class="article-heading"><a href="#type操作符和数据类型" class="headerlink" title="$type操作符和数据类型"></a>$type操作符和数据类型<a class="article-anchor" href="#type操作符和数据类型" aria-hidden="true"></a></h4><p>$type操作符是基于BSON类型来检索集合中匹配的数据类型，并返回结果。</p>
<p>MongoDB 中可以使用的类型如下表所示：</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Number</th>
<th align="left">Alias</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Double</td>
<td align="left">1</td>
<td align="left">“double”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">String</td>
<td align="left">2</td>
<td align="left">“string”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Object</td>
<td align="left">3</td>
<td align="left">“object”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Array</td>
<td align="left">4</td>
<td align="left">“array”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Binary data</td>
<td align="left">5</td>
<td align="left">“binData”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Undefined</td>
<td align="left">6</td>
<td align="left">“undefined”</td>
<td align="left">Deprecated.</td>
</tr>
<tr>
<td align="left">ObjectId</td>
<td align="left">7</td>
<td align="left">“objectId”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Boolean</td>
<td align="left">8</td>
<td align="left">“bool”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Date</td>
<td align="left">9</td>
<td align="left">“date”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Null</td>
<td align="left">10</td>
<td align="left">“null”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Regular Expression</td>
<td align="left">11</td>
<td align="left">“regex”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">DBPointer</td>
<td align="left">12</td>
<td align="left">“dbPointer”</td>
<td align="left">Deprecated.</td>
</tr>
<tr>
<td align="left">JavaScript</td>
<td align="left">13</td>
<td align="left">“javascript”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Symbol</td>
<td align="left">14</td>
<td align="left">“symbol”</td>
<td align="left">Deprecated.</td>
</tr>
<tr>
<td align="left">JavaScript (with scope)</td>
<td align="left">15</td>
<td align="left">“javascriptWithScope”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">32-bit integer</td>
<td align="left">16</td>
<td align="left">“int”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Timestamp</td>
<td align="left">17</td>
<td align="left">“timestamp”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">64-bit integer</td>
<td align="left">18</td>
<td align="left">“long”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Decimal128</td>
<td align="left">19</td>
<td align="left">“decimal”</td>
<td align="left">New in version 3.4.</td>
</tr>
<tr>
<td align="left">Min key</td>
<td align="left">-1</td>
<td align="left">“minKey”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Max key</td>
<td align="left">127</td>
<td align="left">“maxKey”</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>基本数据类型</p>
<p>null：用于表示空值或者不存在的字段，{“x”:null}</p>
<p>布尔型：布尔类型有两个值true和false，{“x”:true}</p>
<p>数值：shell默认使用64为浮点型数值。{“x”：3.14}或{“x”：3}。对于整型值，可以使用NumberInt（4字节符号整数）或NumberLong（8字节符号整数），{“x”:NumberInt(“3”)}{“x”:NumberLong(“3”)}</p>
<p>字符串：UTF-8字符串都可以表示为字符串类型的数据，{“x”：“呵呵”}</p>
<p>日期：日期被存储为自新纪元依赖经过的毫秒数，不存储时区，{“x”:new Date()}</p>
<p>正则表达式：查询时，使用正则表达式作为限定条件，语法与JavaScript的正则表达式相同，{“x”:/[abc]/}</p>
<p>数组：数据列表或数据集可以表示为数组，{“x”： [“a“，“b”,”c”]}</p>
<p>内嵌文档：文档可以嵌套其他文档，被嵌套的文档作为值来处理，{“x”:{“y”:3 }}</p>
<p>对象Id：对象id是一个12字节的字符串，是文档的唯一标识，{“x”: objectId() }</p>
<p>二进制数据：二进制数据是一个任意字节的字符串。它不能直接在shell中使用。如果要将非utf-字符保存到数据库中，二进制数据是唯一的方式。</p>
<p>代码：查询和文档中可以包括任何JavaScript代码，{“x”:function(){/<em>…</em>/}}</p>
<hr>
<p>请先删除原有的集合booboo中的数据，插入新的数据</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.remove({})</span></span><br><span class="line">WriteResult({ "nRemoved" : 4 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find()</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({<span class="string">"title"</span> : <span class="string">"MySQL"</span>, <span class="string">"description"</span> : <span class="string">"MySQL is the most popular Open Source SQL database management system"</span>, <span class="string">"by"</span> : <span class="string">"uplooking"</span>, <span class="string">"url"</span> : <span class="string">"http://www.mysql.com"</span>, <span class="string">"tags"</span> : [ <span class="string">"mysql"</span>, <span class="string">"database"</span> ], <span class="string">"likes"</span> : 200})</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({<span class="string">"title"</span> : <span class="string">"Python"</span>, <span class="string">"description"</span> : <span class="string">"Python is an interpreted, object-oriented, high-level programming language with dynamic semantics"</span>, <span class="string">"by"</span> : <span class="string">"uplooking"</span>, <span class="string">"url"</span> : <span class="string">"http://www.python.org"</span>, <span class="string">"tags"</span> : [ <span class="string">"language"</span>, <span class="string">"python"</span> ], <span class="string">"likes"</span> : 150})</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.insert({title:<span class="string">'MongoDB'</span>,description:<span class="string">'MongoDB is an open-source document database that provides high performance, high availability, and automatic scaling.'</span>,by:<span class="string">'uplooking'</span>,url:<span class="string">'http://www.mongodb.com'</span>,tags:[<span class="string">'mongodb'</span>,<span class="string">'database'</span>],likes:100})</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find().pretty()</span></span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abddf6c7d333637aa4bb3f"),</span><br><span class="line">	"title" : "MySQL",</span><br><span class="line">	"description" : "MySQL is the most popular Open Source SQL database management system",</span><br><span class="line">	"by" : "uplooking",</span><br><span class="line">	"url" : "http://www.mysql.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mysql",</span><br><span class="line">		"database"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 200</span><br><span class="line">}</span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abdf0db1160d1f30d4f518"),</span><br><span class="line">	"title" : "Python",</span><br><span class="line">	"description" : "Python is an interpreted, object-oriented, high-level programming language with dynamic semantics",</span><br><span class="line">	"by" : "uplooking",</span><br><span class="line">	"url" : "http://www.python.org",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"language",</span><br><span class="line">		"python"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 150</span><br><span class="line">}</span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abdf73b1160d1f30d4f519"),</span><br><span class="line">	"title" : "MongoDB",</span><br><span class="line">	"description" : "MongoDB is an open-source document database that provides high performance, high availability, and automatic scaling.",</span><br><span class="line">	"by" : "uplooking",</span><br><span class="line">	"url" : "http://www.mongodb.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mongodb",</span><br><span class="line">		"database"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 100</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<h4 id="MongoDB-操作符-type-实例" class="article-heading"><a href="#MongoDB-操作符-type-实例" class="headerlink" title="MongoDB 操作符 - $type 实例"></a>MongoDB 操作符 - $type 实例<a class="article-anchor" href="#MongoDB-操作符-type-实例" aria-hidden="true"></a></h4></blockquote>
<p>获取 “booboo” 集合中 title 为 String 的数据</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find({<span class="string">'title'</span>:{<span class="variable">$type</span>:2}})</span></span><br><span class="line">{ "_id" : ObjectId("58abddf6c7d333637aa4bb3f"), "title" : "MySQL", "description" : "MySQL is the most popular Open Source SQL database management system", "by" : "uplooking", "url" : "http://www.mysql.com", "tags" : [ "mysql", "database" ], "likes" : 200 }</span><br><span class="line">{ "_id" : ObjectId("58abdf0db1160d1f30d4f518"), "title" : "Python", "description" : "Python is an interpreted, object-oriented, high-level programming language with dynamic semantics", "by" : "uplooking", "url" : "http://www.python.org", "tags" : [ "language", "python" ], "likes" : 150 }</span><br><span class="line">{ "_id" : ObjectId("58abdf73b1160d1f30d4f519"), "title" : "MongoDB", "description" : "MongoDB is an open-source document database that provides high performance, high availability, and automatic scaling.", "by" : "uplooking", "url" : "http://www.mongodb.com", "tags" : [ "mongodb", "database" ], "likes" : 100 }</span><br></pre></td></tr></tbody></table></figure>

<h4 id="limit和skip方法" class="article-heading"><a href="#limit和skip方法" class="headerlink" title="limit和skip方法"></a>limit和skip方法<a class="article-anchor" href="#limit和skip方法" aria-hidden="true"></a></h4><p><strong>MongoDB Limit() 方法</strong></p>
<p>如果你需要在MongoDB中读取指定数量的数据记录，可以使用MongoDB的Limit方法，limit()方法接受一个数字参数，该参数指定从MongoDB中读取的记录条数。</p>
<p>语法</p>
<p>limit()方法基本语法如下所示：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.COLLECTION_NAME.find().<span class="built_in">limit</span>(NUMBER)</span></span><br></pre></td></tr></tbody></table></figure>

<p>实例：只查询集合 booboo 中两条记录</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find().<span class="built_in">limit</span>(2).pretty()</span></span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abddf6c7d333637aa4bb3f"),</span><br><span class="line">	"title" : "MySQL",</span><br><span class="line">	"description" : "MySQL is the most popular Open Source SQL database management system",</span><br><span class="line">	"by" : "uplooking",</span><br><span class="line">	"url" : "http://www.mysql.com",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"mysql",</span><br><span class="line">		"database"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 200</span><br><span class="line">}</span><br><span class="line">{</span><br><span class="line">	"_id" : ObjectId("58abdf0db1160d1f30d4f518"),</span><br><span class="line">	"title" : "Python",</span><br><span class="line">	"description" : "Python is an interpreted, object-oriented, high-level programming language with dynamic semantics",</span><br><span class="line">	"by" : "uplooking",</span><br><span class="line">	"url" : "http://www.python.org",</span><br><span class="line">	"tags" : [</span><br><span class="line">		"language",</span><br><span class="line">		"python"</span><br><span class="line">	],</span><br><span class="line">	"likes" : 150</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>MongoDB Skip() 方法</strong></p>
<p>我们除了可以使用limit()方法来读取指定数量的数据外，还可以使用skip()方法来跳过指定数量的数据，skip方法同样接受一个数字参数作为跳过的记录条数。</p>
<p>语法</p>
<p>skip() 方法脚本语法格式如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.COLLECTION_NAME.find().<span class="built_in">limit</span>(NUMBER).skip(NUMBER)</span></span><br></pre></td></tr></tbody></table></figure>

<p>skip()方法默认参数为 0</p>
<p>实例:</p>
<ol>
<li>跳过一条数据，显示两条</li>
<li>跳过两条数据，显示一条</li>
</ol>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find().<span class="built_in">limit</span>(2).skip(1)</span></span><br><span class="line">{ "_id" : ObjectId("58abdf0db1160d1f30d4f518"), "title" : "Python", "description" : "Python is an interpreted, object-oriented, high-level programming language with dynamic semantics", "by" : "uplooking", "url" : "http://www.python.org", "tags" : [ "language", "python" ], "likes" : 150 }</span><br><span class="line">{ "_id" : ObjectId("58abdf73b1160d1f30d4f519"), "title" : "MongoDB", "description" : "MongoDB is an open-source document database that provides high performance, high availability, and automatic scaling.", "by" : "uplooking", "url" : "http://www.mongodb.com", "tags" : [ "mongodb", "database" ], "likes" : 100 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find().<span class="built_in">limit</span>(1).skip(2)</span></span><br><span class="line">{ "_id" : ObjectId("58abdf73b1160d1f30d4f519"), "title" : "MongoDB", "description" : "MongoDB is an open-source document database that provides high performance, high availability, and automatic scaling.", "by" : "uplooking", "url" : "http://www.mongodb.com", "tags" : [ "mongodb", "database" ], "likes" : 100 }</span><br></pre></td></tr></tbody></table></figure>

<h4 id="排序" class="article-heading"><a href="#排序" class="headerlink" title="排序"></a>排序<a class="article-anchor" href="#排序" aria-hidden="true"></a></h4><p>MongoDB sort()方法</p>
<p>在MongoDB中使用使用sort()方法对数据进行排序，sort()方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而-1是用于降序排列。</p>
<p>注： 如果没有指定sort()方法的排序方式，默认按照文档的升序排列。</p>
<p>语法</p>
<p>sort()方法基本语法如下所示：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.COLLECTION_NAME.find().<span class="built_in">sort</span>({KEY:1})</span></span><br></pre></td></tr></tbody></table></figure>

<p>实例：</p>
<ol>
<li>booboo 集合中的数据按字段 likes 的降序排列</li>
</ol>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; db.booboo.find().<span class="built_in">sort</span>({<span class="string">'likes'</span>:-1})</span></span><br><span class="line">{ "_id" : ObjectId("58abddf6c7d333637aa4bb3f"), "title" : "MySQL", "description" : "MySQL is the most popular Open Source SQL database management system", "by" : "uplooking", "url" : "http://www.mysql.com", "tags" : [ "mysql", "database" ], "likes" : 200 }</span><br><span class="line">{ "_id" : ObjectId("58abdf0db1160d1f30d4f518"), "title" : "Python", "description" : "Python is an interpreted, object-oriented, high-level programming language with dynamic semantics", "by" : "uplooking", "url" : "http://www.python.org", "tags" : [ "language", "python" ], "likes" : 150 }</span><br><span class="line">{ "_id" : ObjectId("58abdf73b1160d1f30d4f519"), "title" : "MongoDB", "description" : "MongoDB is an open-source document database that provides high performance, high availability, and automatic scaling.", "by" : "uplooking", "url" : "http://www.mongodb.com", "tags" : [ "mongodb", "database" ], "likes" : 100 }</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.booboo.find().<span class="built_in">sort</span>({<span class="string">'likes'</span>:1})</span></span><br><span class="line">{ "_id" : ObjectId("58abdf73b1160d1f30d4f519"), "title" : "MongoDB", "description" : "MongoDB is an open-source document database that provides high performance, high availability, and automatic scaling.", "by" : "uplooking", "url" : "http://www.mongodb.com", "tags" : [ "mongodb", "database" ], "likes" : 100 }</span><br><span class="line">{ "_id" : ObjectId("58abdf0db1160d1f30d4f518"), "title" : "Python", "description" : "Python is an interpreted, object-oriented, high-level programming language with dynamic semantics", "by" : "uplooking", "url" : "http://www.python.org", "tags" : [ "language", "python" ], "likes" : 150 }</span><br><span class="line">{ "_id" : ObjectId("58abddf6c7d333637aa4bb3f"), "title" : "MySQL", "description" : "MySQL is the most popular Open Source SQL database management system", "by" : "uplooking", "url" : "http://www.mysql.com", "tags" : [ "mysql", "database" ], "likes" : 200 }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="各种不同类型的索引的创建与使用" class="article-heading"><a href="#各种不同类型的索引的创建与使用" class="headerlink" title="各种不同类型的索引的创建与使用"></a>各种不同类型的索引的创建与使用<a class="article-anchor" href="#各种不同类型的索引的创建与使用" aria-hidden="true"></a></h3><h4 id="MongoDB-索引" class="article-heading"><a href="#MongoDB-索引" class="headerlink" title="MongoDB 索引"></a>MongoDB 索引<a class="article-anchor" href="#MongoDB-索引" aria-hidden="true"></a></h4><p>索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文件并选取那些符合查询条件的记录。</p>
<p>这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。</p>
<p>索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构</p>
<h4 id="单键索引" class="article-heading"><a href="#单键索引" class="headerlink" title="单键索引"></a>单键索引<a class="article-anchor" href="#单键索引" aria-hidden="true"></a></h4><p>MongoDB使用 createIndex() 方法来创建索引。</p>
<p>语法</p>
<p>ensureIndex()方法基本语法格式如下所示：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.COLLECTION_NAME.createIndex({KEY:1})</span></span><br></pre></td></tr></tbody></table></figure>

<p>语法中 Key 值为你要创建的索引字段，1为指定按升序创建索引，如果你想按降序来创建索引指定为-1即可。</p>
<p>实例</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">数据库uplooking中，新建一个集合<span class="built_in">test</span>，循环插入10万个文档</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">for</span> (var i=0;i&lt;100000;i++){</span></span><br><span class="line">... db.test.insert({username:'user'+i})</span><br><span class="line">... }</span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br></pre></td></tr></tbody></table></figure>

<p>在任意游标(例如 查询）后面附加 explain() 方法可以返回一个含有查询过程的统计数据的文档，包括所使用的索引，扫描过的文档数，查询所消耗的毫秒数。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.test.find({username:<span class="string">'user1234'</span>}).explain(<span class="string">'executionStats'</span>)</span></span><br><span class="line">{</span><br><span class="line">	"queryPlanner" : {</span><br><span class="line">		"plannerVersion" : 1,</span><br><span class="line">		"namespace" : "uplooking.test",</span><br><span class="line">		"indexFilterSet" : false,</span><br><span class="line">		"parsedQuery" : {</span><br><span class="line">			"username" : {</span><br><span class="line">				"$eq" : "user1234"</span><br><span class="line">			}</span><br><span class="line">		},</span><br><span class="line">		"winningPlan" : {</span><br><span class="line">			"stage" : "COLLSCAN",</span><br><span class="line">			"filter" : {</span><br><span class="line">				"username" : {</span><br><span class="line">					"$eq" : "user1234"</span><br><span class="line">				}</span><br><span class="line">			},</span><br><span class="line">			"direction" : "forward"</span><br><span class="line">		},</span><br><span class="line">		"rejectedPlans" : [ ]</span><br><span class="line">	},</span><br><span class="line">	"executionStats" : {</span><br><span class="line">		"executionSuccess" : true,</span><br><span class="line">		"nReturned" : 1,</span><br><span class="line">		"executionTimeMillis" : 329,</span><br><span class="line">		"totalKeysExamined" : 0,</span><br><span class="line">		"totalDocsExamined" : 100000,</span><br><span class="line">		"executionStages" : {</span><br><span class="line">			"stage" : "COLLSCAN",</span><br><span class="line">			"filter" : {</span><br><span class="line">				"username" : {</span><br><span class="line">					"$eq" : "user1234"</span><br><span class="line">				}</span><br><span class="line">			},</span><br><span class="line">			"nReturned" : 1,</span><br><span class="line">			"executionTimeMillisEstimate" : 307,</span><br><span class="line">			"works" : 100002,</span><br><span class="line">			"advanced" : 1,</span><br><span class="line">			"needTime" : 100000,</span><br><span class="line">			"needYield" : 0,</span><br><span class="line">			"saveState" : 791,</span><br><span class="line">			"restoreState" : 791,</span><br><span class="line">			"isEOF" : 1,</span><br><span class="line">			"invalidates" : 0,</span><br><span class="line">			"direction" : "forward",</span><br><span class="line">			"docsExamined" : 100000</span><br><span class="line">		}</span><br><span class="line">	},</span><br><span class="line">	"serverInfo" : {</span><br><span class="line">		"host" : "mastera.uplooking.com",</span><br><span class="line">		"port" : 27017,</span><br><span class="line">		"version" : "3.4.1",</span><br><span class="line">		"gitVersion" : "5e103c4f5583e2566a45d740225dc250baacfbd7"</span><br><span class="line">	},</span><br><span class="line">	"ok" : 1</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>参数很多，目前我们只关注其中的”totalDocsExamined” : 100000和”executionTimeMillis” : 329</p>
<p>在完成这个查询过程中扫描的文档总数为10万，执行的总时长为30毫秒。</p>
<p>如果数据有1000万个，如果每次查询文档都要遍历一遍，那么时间是相当的长的。</p>
<p>对于此类查询，索引是一个非常好的解决方案。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.test.createIndex({<span class="string">'username'</span>:1})</span></span><br><span class="line">{</span><br><span class="line">	"createdCollectionAutomatically" : false,</span><br><span class="line">	"numIndexesBefore" : 1,</span><br><span class="line">	"numIndexesAfter" : 2,</span><br><span class="line">	"ok" : 1</span><br><span class="line">}</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.test.find({username:<span class="string">'user1234'</span>}).explain(<span class="string">'executionStats'</span>)</span></span><br><span class="line">{</span><br><span class="line">	"queryPlanner" : {</span><br><span class="line">		"plannerVersion" : 1,</span><br><span class="line">		"namespace" : "uplooking.test",</span><br><span class="line">		"indexFilterSet" : false,</span><br><span class="line">		"parsedQuery" : {</span><br><span class="line">			"username" : {</span><br><span class="line">				"$eq" : "user1234"</span><br><span class="line">			}</span><br><span class="line">		},</span><br><span class="line">		"winningPlan" : {</span><br><span class="line">			"stage" : "FETCH",</span><br><span class="line">			"inputStage" : {</span><br><span class="line">				"stage" : "IXSCAN",</span><br><span class="line">				"keyPattern" : {</span><br><span class="line">					"username" : 1</span><br><span class="line">				},</span><br><span class="line">				"indexName" : "username_1",</span><br><span class="line">				"isMultiKey" : false,</span><br><span class="line">				"multiKeyPaths" : {</span><br><span class="line">					"username" : [ ]</span><br><span class="line">				},</span><br><span class="line">				"isUnique" : false,</span><br><span class="line">				"isSparse" : false,</span><br><span class="line">				"isPartial" : false,</span><br><span class="line">				"indexVersion" : 2,</span><br><span class="line">				"direction" : "forward",</span><br><span class="line">				"indexBounds" : {</span><br><span class="line">					"username" : [</span><br><span class="line">						"[\"user1234\", \"user1234\"]"</span><br><span class="line">					]</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		},</span><br><span class="line">		"rejectedPlans" : [ ]</span><br><span class="line">	},</span><br><span class="line">	"executionStats" : {</span><br><span class="line">		"executionSuccess" : true,</span><br><span class="line">		"nReturned" : 1,</span><br><span class="line">		"executionTimeMillis" : 56,</span><br><span class="line">		"totalKeysExamined" : 1,</span><br><span class="line">		"totalDocsExamined" : 1,</span><br><span class="line">		"executionStages" : {</span><br><span class="line">			"stage" : "FETCH",</span><br><span class="line">			"nReturned" : 1,</span><br><span class="line">			"executionTimeMillisEstimate" : 20,</span><br><span class="line">			"works" : 2,</span><br><span class="line">			"advanced" : 1,</span><br><span class="line">			"needTime" : 0,</span><br><span class="line">			"needYield" : 0,</span><br><span class="line">			"saveState" : 1,</span><br><span class="line">			"restoreState" : 1,</span><br><span class="line">			"isEOF" : 1,</span><br><span class="line">			"invalidates" : 0,</span><br><span class="line">			"docsExamined" : 1,</span><br><span class="line">			"alreadyHasObj" : 0,</span><br><span class="line">			"inputStage" : {</span><br><span class="line">				"stage" : "IXSCAN",</span><br><span class="line">				"nReturned" : 1,</span><br><span class="line">				"executionTimeMillisEstimate" : 20,</span><br><span class="line">				"works" : 2,</span><br><span class="line">				"advanced" : 1,</span><br><span class="line">				"needTime" : 0,</span><br><span class="line">				"needYield" : 0,</span><br><span class="line">				"saveState" : 1,</span><br><span class="line">				"restoreState" : 1,</span><br><span class="line">				"isEOF" : 1,</span><br><span class="line">				"invalidates" : 0,</span><br><span class="line">				"keyPattern" : {</span><br><span class="line">					"username" : 1</span><br><span class="line">				},</span><br><span class="line">				"indexName" : "username_1",</span><br><span class="line">				"isMultiKey" : false,</span><br><span class="line">				"multiKeyPaths" : {</span><br><span class="line">					"username" : [ ]</span><br><span class="line">				},</span><br><span class="line">				"isUnique" : false,</span><br><span class="line">				"isSparse" : false,</span><br><span class="line">				"isPartial" : false,</span><br><span class="line">				"indexVersion" : 2,</span><br><span class="line">				"direction" : "forward",</span><br><span class="line">				"indexBounds" : {</span><br><span class="line">					"username" : [</span><br><span class="line">						"[\"user1234\", \"user1234\"]"</span><br><span class="line">					]</span><br><span class="line">				},</span><br><span class="line">				"keysExamined" : 1,</span><br><span class="line">				"seeks" : 1,</span><br><span class="line">				"dupsTested" : 0,</span><br><span class="line">				"dupsDropped" : 0,</span><br><span class="line">				"seenInvalidated" : 0</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	},</span><br><span class="line">	"serverInfo" : {</span><br><span class="line">		"host" : "mastera.uplooking.com",</span><br><span class="line">		"port" : 27017,</span><br><span class="line">		"version" : "3.4.1",</span><br><span class="line">		"gitVersion" : "5e103c4f5583e2566a45d740225dc250baacfbd7"</span><br><span class="line">	},</span><br><span class="line">	"ok" : 1</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到”executionTimeMillis” : 56,”totalDocsExamined” : 1</p>
<p>一共只扫描了1个文档，总执行时间为56毫秒</p>
<p>的确有点不可思议，查询在瞬间完成，因为通过索引只查找了一条数据，而不是100000条。</p>
<p>当然使用索引是也是有代价的：对于添加的每一条索引，每次写操作（插入、更新、删除）都将耗费更多的时间。这是因为，当数据发生变化时，不仅要更新文档，还要更新级集合上的所有索引。因此，mongodb限制每个集合最多有64个索引。通常，在一个特定的集合上，不应该拥有两个以上的索引。</p>
<h4 id="复合索引" class="article-heading"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引<a class="article-anchor" href="#复合索引" aria-hidden="true"></a></h4><p>复合索引可以支持要求匹配多个键的查询。</p>
<p>索引的值是按一定顺序排列的，所以使用索引键对文档进行排序非常快。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.COLLECTION_NAME.createIndex({KEY:1,KEY:1})</span></span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">这里先根据age排序再根据username排序，所以username在这里发挥的作用并不大。为了优化这个排序，可能需要在age和username上建立索引。</span><br><span class="line"></span><br><span class="line">db.users.ensureIndex({'age':1, 'username': 1})</span><br><span class="line"></span><br><span class="line">这就建立了一个复合索引（建立在多个字段上的索引），如果查询条件包括多个键，这个索引就非常有用。</span><br><span class="line"></span><br><span class="line">建立复合索引后，每个索引条目都包括一个age字段和一个username字段，并且指向文档在磁盘上的存储位置。</span><br><span class="line"></span><br><span class="line">此时，age字段是严格升序排列的，如果age相等时再按照username升序排列。</span><br><span class="line"></span><br><span class="line">语法</span><br><span class="line"></span><br><span class="line">​```shell</span><br><span class="line">db.users.createIndex({name:1,age:1})</span><br></pre></td></tr></tbody></table></figure>

<p>实例</p>
<p>新建users集合并循环插入文档</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">for</span> (var i=1;i&lt;1000;i++){ <span class="keyword">for</span> (var j=100;j&gt;1;j--) { db.users.insert({name:<span class="string">'user'</span>+i,age:j})   }}</span></span><br><span class="line">WriteResult({ "nInserted" : 1 })</span><br></pre></td></tr></tbody></table></figure>

<p>测试一下查询{name:’user123’,age:{$lt:5}}耗时多少</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.users.find({name:<span class="string">'user123'</span>,age:{<span class="variable">$lt</span>:5}})</span></span><br><span class="line">{ "_id" : ObjectId("58ad368e89f7c6bec3f0a3c8"), "name" : "user123", "age" : 4 }</span><br><span class="line">{ "_id" : ObjectId("58ad368e89f7c6bec3f0a3c9"), "name" : "user123", "age" : 3 }</span><br><span class="line">{ "_id" : ObjectId("58ad368e89f7c6bec3f0a3ca"), "name" : "user123", "age" : 2 }</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.users.find({name:<span class="string">'user123'</span>,age:{<span class="variable">$lt</span>:5}}).explain(<span class="string">'executionStats'</span>)</span></span><br><span class="line">{</span><br><span class="line">	"queryPlanner" : {</span><br><span class="line">		"plannerVersion" : 1,</span><br><span class="line">		"namespace" : "uplooking.users",</span><br><span class="line">		"indexFilterSet" : false,</span><br><span class="line">		"parsedQuery" : {</span><br><span class="line">			"$and" : [</span><br><span class="line">				{</span><br><span class="line">					"name" : {</span><br><span class="line">						"$eq" : "user123"</span><br><span class="line">					}</span><br><span class="line">				},</span><br><span class="line">				{</span><br><span class="line">					"age" : {</span><br><span class="line">						"$lt" : 5</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			]</span><br><span class="line">		},</span><br><span class="line">		"winningPlan" : {</span><br><span class="line">			"stage" : "COLLSCAN",</span><br><span class="line">			"filter" : {</span><br><span class="line">				"$and" : [</span><br><span class="line">					{</span><br><span class="line">						"name" : {</span><br><span class="line">							"$eq" : "user123"</span><br><span class="line">						}</span><br><span class="line">					},</span><br><span class="line">					{</span><br><span class="line">						"age" : {</span><br><span class="line">							"$lt" : 5</span><br><span class="line">						}</span><br><span class="line">					}</span><br><span class="line">				]</span><br><span class="line">			},</span><br><span class="line">			"direction" : "forward"</span><br><span class="line">		},</span><br><span class="line">		"rejectedPlans" : [ ]</span><br><span class="line">	},</span><br><span class="line">	"executionStats" : {</span><br><span class="line">		"executionSuccess" : true,</span><br><span class="line">		"nReturned" : 3,</span><br><span class="line">		"executionTimeMillis" : 98,</span><br><span class="line">		"totalKeysExamined" : 0,</span><br><span class="line">		"totalDocsExamined" : 98901,</span><br><span class="line">		"executionStages" : {</span><br><span class="line">			"stage" : "COLLSCAN",</span><br><span class="line">			"filter" : {</span><br><span class="line">				"$and" : [</span><br><span class="line">					{</span><br><span class="line">						"name" : {</span><br><span class="line">							"$eq" : "user123"</span><br><span class="line">						}</span><br><span class="line">					},</span><br><span class="line">					{</span><br><span class="line">						"age" : {</span><br><span class="line">							"$lt" : 5</span><br><span class="line">						}</span><br><span class="line">					}</span><br><span class="line">				]</span><br><span class="line">			},</span><br><span class="line">			"nReturned" : 3,</span><br><span class="line">			"executionTimeMillisEstimate" : 58,</span><br><span class="line">			"works" : 98903,</span><br><span class="line">			"advanced" : 3,</span><br><span class="line">			"needTime" : 98899,</span><br><span class="line">			"needYield" : 0,</span><br><span class="line">			"saveState" : 775,</span><br><span class="line">			"restoreState" : 775,</span><br><span class="line">			"isEOF" : 1,</span><br><span class="line">			"invalidates" : 0,</span><br><span class="line">			"direction" : "forward",</span><br><span class="line">			"docsExamined" : 98901</span><br><span class="line">		}</span><br><span class="line">	},</span><br><span class="line">	"serverInfo" : {</span><br><span class="line">		"host" : "mastera.uplooking.com",</span><br><span class="line">		"port" : 27017,</span><br><span class="line">		"version" : "3.4.1",</span><br><span class="line">		"gitVersion" : "5e103c4f5583e2566a45d740225dc250baacfbd7"</span><br><span class="line">	},</span><br><span class="line">	"ok" : 1</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>重点观察以下参数</p>
<ul>
<li>“executionTimeMillis” : 98,</li>
<li>“totalKeysExamined” : 0,</li>
<li>“totalDocsExamined” : 98901,</li>
</ul>
<p>耗时98毫秒，一共扫描了9万多个文档</p>
<p>创建复合索引{name:1,age:1}后，再查询耗时又为多少？</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.users.createIndex({name:1,age:1})</span></span><br><span class="line">{</span><br><span class="line">	"createdCollectionAutomatically" : false,</span><br><span class="line">	"numIndexesBefore" : 1,</span><br><span class="line">	"numIndexesAfter" : 2,</span><br><span class="line">	"ok" : 1</span><br><span class="line">}</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.users.find({name:<span class="string">'user123'</span>,age:{<span class="variable">$lt</span>:5}}).explain(<span class="string">'executionStats'</span>)</span></span><br><span class="line">{</span><br><span class="line">	"queryPlanner" : {</span><br><span class="line">		"plannerVersion" : 1,</span><br><span class="line">		"namespace" : "uplooking.users",</span><br><span class="line">		"indexFilterSet" : false,</span><br><span class="line">		"parsedQuery" : {</span><br><span class="line">			"$and" : [</span><br><span class="line">				{</span><br><span class="line">					"name" : {</span><br><span class="line">						"$eq" : "user123"</span><br><span class="line">					}</span><br><span class="line">				},</span><br><span class="line">				{</span><br><span class="line">					"age" : {</span><br><span class="line">						"$lt" : 5</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			]</span><br><span class="line">		},</span><br><span class="line">		"winningPlan" : {</span><br><span class="line">			"stage" : "FETCH",</span><br><span class="line">			"inputStage" : {</span><br><span class="line">				"stage" : "IXSCAN",</span><br><span class="line">				"keyPattern" : {</span><br><span class="line">					"name" : 1,</span><br><span class="line">					"age" : 1</span><br><span class="line">				},</span><br><span class="line">				"indexName" : "name_1_age_1",</span><br><span class="line">				"isMultiKey" : false,</span><br><span class="line">				"multiKeyPaths" : {</span><br><span class="line">					"name" : [ ],</span><br><span class="line">					"age" : [ ]</span><br><span class="line">				},</span><br><span class="line">				"isUnique" : false,</span><br><span class="line">				"isSparse" : false,</span><br><span class="line">				"isPartial" : false,</span><br><span class="line">				"indexVersion" : 2,</span><br><span class="line">				"direction" : "forward",</span><br><span class="line">				"indexBounds" : {</span><br><span class="line">					"name" : [</span><br><span class="line">						"[\"user123\", \"user123\"]"</span><br><span class="line">					],</span><br><span class="line">					"age" : [</span><br><span class="line">						"[-inf.0, 5.0)"</span><br><span class="line">					]</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		},</span><br><span class="line">		"rejectedPlans" : [ ]</span><br><span class="line">	},</span><br><span class="line">	"executionStats" : {</span><br><span class="line">		"executionSuccess" : true,</span><br><span class="line">		"nReturned" : 3,</span><br><span class="line">		"executionTimeMillis" : 53,</span><br><span class="line">		"totalKeysExamined" : 3,</span><br><span class="line">		"totalDocsExamined" : 3,</span><br><span class="line">		"executionStages" : {</span><br><span class="line">			"stage" : "FETCH",</span><br><span class="line">			"nReturned" : 3,</span><br><span class="line">			"executionTimeMillisEstimate" : 0,</span><br><span class="line">			"works" : 4,</span><br><span class="line">			"advanced" : 3,</span><br><span class="line">			"needTime" : 0,</span><br><span class="line">			"needYield" : 0,</span><br><span class="line">			"saveState" : 0,</span><br><span class="line">			"restoreState" : 0,</span><br><span class="line">			"isEOF" : 1,</span><br><span class="line">			"invalidates" : 0,</span><br><span class="line">			"docsExamined" : 3,</span><br><span class="line">			"alreadyHasObj" : 0,</span><br><span class="line">			"inputStage" : {</span><br><span class="line">				"stage" : "IXSCAN",</span><br><span class="line">				"nReturned" : 3,</span><br><span class="line">				"executionTimeMillisEstimate" : 0,</span><br><span class="line">				"works" : 4,</span><br><span class="line">				"advanced" : 3,</span><br><span class="line">				"needTime" : 0,</span><br><span class="line">				"needYield" : 0,</span><br><span class="line">				"saveState" : 0,</span><br><span class="line">				"restoreState" : 0,</span><br><span class="line">				"isEOF" : 1,</span><br><span class="line">				"invalidates" : 0,</span><br><span class="line">				"keyPattern" : {</span><br><span class="line">					"name" : 1,</span><br><span class="line">					"age" : 1</span><br><span class="line">				},</span><br><span class="line">				"indexName" : "name_1_age_1",</span><br><span class="line">				"isMultiKey" : false,</span><br><span class="line">				"multiKeyPaths" : {</span><br><span class="line">					"name" : [ ],</span><br><span class="line">					"age" : [ ]</span><br><span class="line">				},</span><br><span class="line">				"isUnique" : false,</span><br><span class="line">				"isSparse" : false,</span><br><span class="line">				"isPartial" : false,</span><br><span class="line">				"indexVersion" : 2,</span><br><span class="line">				"direction" : "forward",</span><br><span class="line">				"indexBounds" : {</span><br><span class="line">					"name" : [</span><br><span class="line">						"[\"user123\", \"user123\"]"</span><br><span class="line">					],</span><br><span class="line">					"age" : [</span><br><span class="line">						"[-inf.0, 5.0)"</span><br><span class="line">					]</span><br><span class="line">				},</span><br><span class="line">				"keysExamined" : 3,</span><br><span class="line">				"seeks" : 1,</span><br><span class="line">				"dupsTested" : 0,</span><br><span class="line">				"dupsDropped" : 0,</span><br><span class="line">				"seenInvalidated" : 0</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	},</span><br><span class="line">	"serverInfo" : {</span><br><span class="line">		"host" : "mastera.uplooking.com",</span><br><span class="line">		"port" : 27017,</span><br><span class="line">		"version" : "3.4.1",</span><br><span class="line">		"gitVersion" : "5e103c4f5583e2566a45d740225dc250baacfbd7"</span><br><span class="line">	},</span><br><span class="line">	"ok" : 1</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>没有创建索引前，耗时98毫秒，一共扫描了9万多个文档，现在只消耗了53毫秒，扫描3个文档。</p>
<h4 id="多键索引" class="article-heading"><a href="#多键索引" class="headerlink" title="多键索引"></a>多键索引<a class="article-anchor" href="#多键索引" aria-hidden="true"></a></h4><p>在MongoDB中可以基于数组来创建索引。MongoDB为数组每一个元素创建索引值。</p>
<p>多键索引支持数组字段的高效查询。多键索引能够基于字符串，数字数组以及嵌套文档进行创建。</p>
<p>基于一个数组创建索引，MongoDB会自动创建为多键索引，无需刻意指定</p>
<ol>
<li>多键索引也可以基于内嵌文档来创建</li>
<li>多键索引的边界值的计算依赖于特定的规则</li>
</ol>
<blockquote>
<p>注，多键索引不等于在文档上的多列创建索引(复合索引)</p>
</blockquote>
<p>创建语法</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">db.coll.createIndex( { &lt;field&gt;: &lt; 1 or -1 &gt; } )</span><br></pre></td></tr></tbody></table></figure>

<p>复合多键索引</p>
<ol>
<li><p>对于一个复合多键索引，每个索引最多可以包含一个数组。</p>
</li>
<li><p>在多于一个数组的情形下来创建复合多键索引不被支持。</p>
</li>
</ol>
<blockquote>
<p>假定存在如下集合</p>
</blockquote>
<p><code>{ _id: 1, a: [ 1, 2 ], b: [ 1, 2 ], category: "AB - both arrays" }</code></p>
<p>不能基于一个基于{ a: 1, b: 1 } 的多键索引，因为a和b都是数组</p>
<blockquote>
<p>假定存在如下集合</p>
</blockquote>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">{ _id: 1, a: [1, 2], b: 1, category: "A array" }</span><br><span class="line">{ _id: 2, a: 1, b: [1, 2], category: "B array" }</span><br></pre></td></tr></tbody></table></figure>

<p>则可以基于每一个文档创建一个基于{ a: 1, b: 1 }的复合多键索引</p>
<p>原因是每一个索引的索引字段只有一个数组</p>
<p>一些限制</p>
<ul>
<li>不能够指定一个多键索引为分片片键索引</li>
<li>哈希索引不能够成为多键索引</li>
<li>多键索引不支持覆盖查询</li>
</ul>
<p>基于整体查询数组字段</p>
<ul>
<li>当一个查询筛选器将一个数组作为整体实现精确匹配时，MongoDB可以使用多键索引查找数组的第一个元素，</li>
<li>但不能使用多键索引扫描寻找整个数组。相反，使用多键索引查找查询数组的第一个元素后，MongoDB检索</li>
<li>相关文档并且过滤出那些复合匹配条件的文档。</li>
</ul>
<h4 id="文本索引" class="article-heading"><a href="#文本索引" class="headerlink" title="文本索引"></a>文本索引<a class="article-anchor" href="#文本索引" aria-hidden="true"></a></h4><h4 id="2dsphere索引" class="article-heading"><a href="#2dsphere索引" class="headerlink" title="2dsphere索引"></a>2dsphere索引<a class="article-anchor" href="#2dsphere索引" aria-hidden="true"></a></h4><h4 id="2d索引" class="article-heading"><a href="#2d索引" class="headerlink" title="2d索引"></a>2d索引<a class="article-anchor" href="#2d索引" aria-hidden="true"></a></h4><h4 id="Hashed索引" class="article-heading"><a href="#Hashed索引" class="headerlink" title="Hashed索引"></a>Hashed索引<a class="article-anchor" href="#Hashed索引" aria-hidden="true"></a></h4><h4 id="索引属性" class="article-heading"><a href="#索引属性" class="headerlink" title="索引属性"></a>索引属性<a class="article-anchor" href="#索引属性" aria-hidden="true"></a></h4><h4 id="索引创建" class="article-heading"><a href="#索引创建" class="headerlink" title="索引创建"></a>索引创建<a class="article-anchor" href="#索引创建" aria-hidden="true"></a></h4><h4 id="索引交集" class="article-heading"><a href="#索引交集" class="headerlink" title="索引交集"></a>索引交集<a class="article-anchor" href="#索引交集" aria-hidden="true"></a></h4><h4 id="管理索引" class="article-heading"><a href="#管理索引" class="headerlink" title="管理索引"></a>管理索引<a class="article-anchor" href="#管理索引" aria-hidden="true"></a></h4><h4 id="衡量索引的使用情况" class="article-heading"><a href="#衡量索引的使用情况" class="headerlink" title="衡量索引的使用情况"></a>衡量索引的使用情况<a class="article-anchor" href="#衡量索引的使用情况" aria-hidden="true"></a></h4><h4 id="索引策略" class="article-heading"><a href="#索引策略" class="headerlink" title="索引策略"></a>索引策略<a class="article-anchor" href="#索引策略" aria-hidden="true"></a></h4><h3 id="复杂的聚合查询" class="article-heading"><a href="#复杂的聚合查询" class="headerlink" title="复杂的聚合查询"></a>复杂的聚合查询<a class="article-anchor" href="#复杂的聚合查询" aria-hidden="true"></a></h3><h3 id="对数据集合进行分片-在不同分片间维持均衡" class="article-heading"><a href="#对数据集合进行分片-在不同分片间维持均衡" class="headerlink" title="对数据集合进行分片 在不同分片间维持均衡"></a>对数据集合进行分片 在不同分片间维持均衡<a class="article-anchor" href="#对数据集合进行分片-在不同分片间维持均衡" aria-hidden="true"></a></h3><h3 id="数据备份与恢复" class="article-heading"><a href="#数据备份与恢复" class="headerlink" title="数据备份与恢复"></a>数据备份与恢复<a class="article-anchor" href="#数据备份与恢复" aria-hidden="true"></a></h3><h3 id="数据迁移" class="article-heading"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移<a class="article-anchor" href="#数据迁移" aria-hidden="true"></a></h3><h2 id="简单运维-MongoDB" class="article-heading"><a href="#简单运维-MongoDB" class="headerlink" title="简单运维 MongoDB"></a>简单运维 MongoDB<a class="article-anchor" href="#简单运维-MongoDB" aria-hidden="true"></a></h2><h3 id="部署-MongoDB-集群" class="article-heading"><a href="#部署-MongoDB-集群" class="headerlink" title="部署 MongoDB 集群"></a>部署 MongoDB 集群<a class="article-anchor" href="#部署-MongoDB-集群" aria-hidden="true"></a></h3><h3 id="处理多种常见的故障" class="article-heading"><a href="#处理多种常见的故障" class="headerlink" title="处理多种常见的故障"></a>处理多种常见的故障<a class="article-anchor" href="#处理多种常见的故障" aria-hidden="true"></a></h3><h3 id="单节点失效-如何恢复工作" class="article-heading"><a href="#单节点失效-如何恢复工作" class="headerlink" title="单节点失效 如何恢复工作"></a>单节点失效 如何恢复工作<a class="article-anchor" href="#单节点失效-如何恢复工作" aria-hidden="true"></a></h3><h3 id="数据库意外被杀死如何进行数据恢复" class="article-heading"><a href="#数据库意外被杀死如何进行数据恢复" class="headerlink" title="数据库意外被杀死如何进行数据恢复"></a>数据库意外被杀死如何进行数据恢复<a class="article-anchor" href="#数据库意外被杀死如何进行数据恢复" aria-hidden="true"></a></h3><h3 id="数据库发生拒绝服务时如何排查原因" class="article-heading"><a href="#数据库发生拒绝服务时如何排查原因" class="headerlink" title="数据库发生拒绝服务时如何排查原因"></a>数据库发生拒绝服务时如何排查原因<a class="article-anchor" href="#数据库发生拒绝服务时如何排查原因" aria-hidden="true"></a></h3><h3 id="数据库磁盘快满时如何处理" class="article-heading"><a href="#数据库磁盘快满时如何处理" class="headerlink" title="数据库磁盘快满时如何处理"></a>数据库磁盘快满时如何处理<a class="article-anchor" href="#数据库磁盘快满时如何处理" aria-hidden="true"></a></h3><h2 id="难度" class="article-heading"><a href="#难度" class="headerlink" title="难度"></a>难度<a class="article-anchor" href="#难度" aria-hidden="true"></a></h2><ul>
<li>初级 背景知识 基本操作</li>
<li>中级 常见部署操作 简单运维</li>
<li>高级 介绍集群及大型集群的运维经验及 mongoDB 的实现原理 常见问题及解决方案</li>
</ul>
<h3 id="如何运维一个几十T甚至上百T的MongoDB数据库" class="article-heading"><a href="#如何运维一个几十T甚至上百T的MongoDB数据库" class="headerlink" title="如何运维一个几十T甚至上百T的MongoDB数据库"></a>如何运维一个几十T甚至上百T的MongoDB数据库<a class="article-anchor" href="#如何运维一个几十T甚至上百T的MongoDB数据库" aria-hidden="true"></a></h3><h3 id="如何维持几十个甚至上百个节点的MongoDB数据库的均衡" class="article-heading"><a href="#如何维持几十个甚至上百个节点的MongoDB数据库的均衡" class="headerlink" title="如何维持几十个甚至上百个节点的MongoDB数据库的均衡"></a>如何维持几十个甚至上百个节点的MongoDB数据库的均衡<a class="article-anchor" href="#如何维持几十个甚至上百个节点的MongoDB数据库的均衡" aria-hidden="true"></a></h3><p>​</p>
</body></html>
              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2025-10-22T08:49:24.715Z" itemprop="dateModified">Last updated: 2025-10-22</time>
                <a href="/database/mysql/index.html" class="article-footer-next" title="概览"><span>Next</span><i class="fa fa-chevron-right"></i></a>
              </footer>
              
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <div id="carbonads" class="carbonads" style="text-align:center;font-family:'Noto Sans SC',sans-serif;">
  <span class="carbon-wrap">
    <a href="https://github.com/booboowei"
       class="carbon-img"
       target="_blank"
       rel="noopener sponsored">
      <img
        src="https://avatars2.githubusercontent.com/u/21328020?s=460&u=88cf6127c32932188f936d05636b7b0d36783ee1&v=4"
        alt="ads via Carbon"
        border="0"
        style="width:80px;height:80px;border-radius:50%;max-width:130px;"
      />
    </a>
    <a href="/about/"
       class="carbon-text"
       target="_blank"
       rel="noopener sponsored"
       style="display:block;margin-top:4px;">
      欢迎光临
    </a>
  </span>

  <!-- 日期显示 -->
  <div id="today-date" style="margin-top:12px;background:#f5f5f5;border-radius:12px;padding:10px 0;">
    <div id="weekday" style="font-size:14px;color:#555;"></div>
    <div id="day" style="font-size:36px;font-weight:bold;color:#000;"></div>
    <div id="ym" style="font-size:14px;color:#555;"></div>
    <div id="lunar" style="font-size:13px;color:#888;margin-top:4px;"></div>
  </div>

<script>
(function(){
  const now = new Date();
  const weekdays = ["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];
  const year = now.getFullYear();
  const month = now.getMonth() + 1;
  const day = now.getDate();

  function toChineseNumber(num) {
    const map = {0:'〇',1:'一',2:'二',3:'三',4:'四',5:'五',6:'六',7:'七',8:'八',9:'九'};
    return String(num).split('').map(n=>map[n]).join('');
  }

  // 优先使用 Intl (现代浏览器支持农历/中国传统历)
  function getLunarByIntl(date) {
    try {
      // 获取农历的月（长格式，如 "九月" 或 "闰八月"），和日（数字）
      const monthFormatter = new Intl.DateTimeFormat('zh-CN-u-ca-chinese', { month: 'long' });
      const dayFormatter = new Intl.DateTimeFormat('zh-CN-u-ca-chinese', { day: 'numeric' });
      const lunarMonthText = monthFormatter.format(date); // 例如 "九月" 或 "闰八月"
      const lunarDayText = dayFormatter.format(date);     // 例如 "三十" 或 "初一"
      // 有的浏览器返回的 month 会包含 "闰" 字样，也可能返回汉字月份，需要适配
      return `农历${lunarMonthText}${lunarDayText}`;
    } catch (e) {
      return null; // 表示不支持 Intl 农历
    }
  }

  // 回退：简易本地农历算法（仅作兼容，适用于1900-2049范围）
  const lunarInfo = [0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
                     0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
                     0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
                     0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
                     0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,
                     0x06ca0,0x0b550,0x15355,0x04da0,0x0a5b0,0x14573,0x052b0,0x0a9a8,0x0e950,0x06aa0,
                     0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,
                     0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,
                     0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,
                     0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x05ac0,0x0ab60,0x096d5,0x092e0];

  function lYearDays(y){let i,sum=348;for(i=0x8000;i>0x8;i>>=1)sum+=(lunarInfo[y-1900]&i)?1:0;return sum+leapDays(y);}
  function leapDays(y){if(leapMonth(y))return(lunarInfo[y-1900]&0x10000)?30:29;else return 0;}
  function leapMonth(y){return lunarInfo[y-1900]&0xf;}
  function monthDays(y,m){return(lunarInfo[y-1900]&(0x10000>>m))?30:29;}

  function LunarFallback(objDate){
    let i, leap=0, temp=0;
    const baseDate = new Date(1900,0,31);
    let offset = Math.floor((objDate - baseDate) / 86400000);
    let year = 1900;
    // 年循环
    for (i = 1900; i < 2050 && offset > 0; i++) {
      temp = lYearDays(i);
      offset -= temp;
      year = i;
    }
    if (offset < 0) { offset += temp; year--; }
    leap = leapMonth(year);
    let isLeap = false;
    let month = 1;
    // 月循环
    for (i = 1; i <= 12 && offset > 0; i++) {
      if (leap > 0 && i === (leap + 1) && !isLeap) {
        // 进入闰月
        temp = leapDays(year);
        isLeap = true;
        i--; // stay on same month number but mark leap
      } else {
        temp = monthDays(year, i);
      }
      offset -= temp;
      if (isLeap && i === leap) { isLeap = false; }
      if (!isLeap) month++; // 非闰月时才推进月份计数
    }
    if (offset === 0 && leap > 0 && month === leap + 1) {
      // 特殊：当正好落在闰月第一天
      // month 保持，isLeap = true
    }
    if (offset < 0) { offset += temp; month--; }
    const day = offset + 1;
    // 修正 month 边界
    if (month <= 0) month = 1;
    return { year, month, day, isLeap: !!isLeap };
  }

  function getLunarDateStringFallback(y,m,d){
    const cDay=["","初一","初二","初三","初四","初五","初六","初七","初八","初九","初十",
                "十一","十二","十三","十四","十五","十六","十七","十八","十九","二十",
                "廿一","廿二","廿三","廿四","廿五","廿六","廿七","廿八","廿九","三十"];
    const cMon=["","正月","二月","三月","四月","五月","六月","七月","八月","九月","十月","冬月","腊月"];
    const lunar = LunarFallback(new Date(y, m-1, d));
    return `农历${lunar.isLeap ? '闰' : ''}${cMon[lunar.month]}${cDay[lunar.day]}`;
  }

  // 先尝试 Intl 方法
  let lunarText = getLunarByIntl(now);
  if (!lunarText) {
    // 回退本地算法
    lunarText = getLunarDateStringFallback(year, month, day);
  }

  // 输出到页面（公历 + 农历）
  document.getElementById("weekday").textContent = weekdays[now.getDay()];
  document.getElementById("day").textContent = day;
  document.getElementById("ym").textContent = `${toChineseNumber(year)}年${toChineseNumber(month)}月`;
  document.getElementById("lunar").textContent = lunarText;
})();
</script>


              <strong class="sidebar-title">Contents</strong>
              <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%A6%81%E6%B1%82"><span class="toc-text">课程要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-text">概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NoSQL-%E7%AE%80%E4%BB%8B"><span class="toc-text">NoSQL 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8NoSQL"><span class="toc-text">为什么使用NoSQL ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NoSQL-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%B1%BB%E5%9E%8B%E4%B8%80%E8%A7%88%E8%A1%A8"><span class="toc-text">NoSQL 数据库的类型一览表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E7%AE%80%E4%BB%8B"><span class="toc-text">MongoDB 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%AB%99"><span class="toc-text">网站</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">分布式文件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-text">文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-text">集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA-MongoDB"><span class="toc-text">搭建 MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E4%B8%8B%E8%BD%BD"><span class="toc-text">MongoDB 下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E6%90%AD%E5%BB%BA%E7%AE%80%E5%8D%95%E7%9A%84%E5%8D%95%E6%9C%BA%E6%9C%8D%E5%8A%A1"><span class="toc-text">MongoDB 搭建简单的单机服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E4%B8%BArhel7-5-mongodb-4-0-0"><span class="toc-text">实验环境为rhel7.5 mongodb 4.0.0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E4%B8%BArhel7-2-mongodb-3-4-1"><span class="toc-text">实验环境为rhel7.2 mongodb 3.4.1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E7%AD%96%E7%95%A5"><span class="toc-text">MongoDB 安全配置策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Security-Checklist"><span class="toc-text">Security Checklist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83"><span class="toc-text">认证和授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E8%AE%BF%E9%97%AEIP%E5%92%8C%E7%AB%AF%E5%8F%A3"><span class="toc-text">限制访问IP和端口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-text">MongoDB 配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97systemLog-Options"><span class="toc-text">系统日志systemLog Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86processManagement-Options"><span class="toc-text">进程管理processManagement Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%89%E9%A1%B9Net-Options"><span class="toc-text">网络选项Net Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8Security-Options"><span class="toc-text">安全Security Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AEsetParameter-Option"><span class="toc-text">参数设置setParameter Option</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8Storage-Options"><span class="toc-text">存储Storage Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OperationProfiling-Options"><span class="toc-text">OperationProfiling Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6Replication-Options"><span class="toc-text">复制Replication Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%88%86%E7%89%87sharding-Options"><span class="toc-text">集群分片sharding Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%97%A5%E5%BF%97AuditLog-Options"><span class="toc-text">检查日志AuditLog Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE-snmp-Options"><span class="toc-text">简单网络管理协议 snmp Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mongos-only-Options"><span class="toc-text">Mongos-only Options</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows-Service-Options"><span class="toc-text">Windows Service Options</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-WT%E5%BB%BA%E8%AE%AE%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-text">MongoDB WT建议配置项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%AE%9E%E4%BE%8B%E9%85%8D%E7%BD%AE"><span class="toc-text">单实例配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E9%9B%86%E9%85%8D%E7%BD%AE"><span class="toc-text">复制集配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-text">分片集群配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#config-server%E9%85%8D%E7%BD%AE"><span class="toc-text">config server配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mongos%E9%85%8D%E7%BD%AE"><span class="toc-text">Mongos配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E6%90%AD%E5%BB%BA%E5%85%B7%E6%9C%89%E5%86%97%E4%BD%99%E5%AE%B9%E9%94%99%E5%8A%9F%E8%83%BD%E7%9A%84%E5%A4%8D%E5%88%B6%E9%9B%86"><span class="toc-text">MongoDB 搭建具有冗余容错功能的复制集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">搭建主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-text">参数配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-text">客户端配置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%A4%8D%E5%88%B6%E9%9B%86"><span class="toc-text">搭建复制集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B51%E2%80%94%E2%80%94%E6%90%AD%E5%BB%BA%E5%8C%85%E5%90%AB%E4%B8%A4%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%A4%8D%E5%88%B6%E9%9B%86"><span class="toc-text">实践1——搭建包含两台服务器的复制集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B52%E2%80%94%E2%80%94%E6%95%85%E9%9A%9C%E5%88%87%E6%8D%A2%E5%92%8C%E6%B4%BB%E8%B7%83%E8%8A%82%E7%82%B9%E9%80%89%E4%B8%BE"><span class="toc-text">实践2——故障切换和活跃节点选举</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E6%90%AD%E5%BB%BA%E5%A4%A7%E8%A7%84%E6%A8%A1%E6%95%B0%E6%8D%AE%E9%9B%86%E7%BE%A4"><span class="toc-text">MongoDB 搭建大规模数据集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E5%AE%8C%E6%88%90%E9%9B%86%E7%BE%A4%E7%9A%84%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2"><span class="toc-text">MongoDB 完成集群的自动部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-MongoDB"><span class="toc-text">使用 MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mongo-shell"><span class="toc-text">mongo shell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sql%E4%B8%8Emongodb%E6%9C%AF%E8%AF%AD%E5%AF%B9%E6%AF%94"><span class="toc-text">sql与mongodb术语对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="toc-text">数据库命名规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="toc-text">文档命名规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="toc-text">集合命名规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-text">元数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">MongoDB 数据类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%96%87%E6%A1%A3%E7%9A%84%E8%AF%BB%E5%86%99%E6%9B%B4%E6%96%B0%E5%88%A0%E9%99%A4-CRUD"><span class="toc-text">最基本的文档的读写更新删除 CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-use-dbname"><span class="toc-text">创建数据库 use dbname</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93-db-dropDatabase"><span class="toc-text">删除数据库 db.dropDatabase()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3-insert"><span class="toc-text">插入文档 insert()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3-update-save"><span class="toc-text">更新文档 update() save()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3-remove"><span class="toc-text">删除文档 remove()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%9B%86%E5%90%88-drop"><span class="toc-text">删除集合 drop()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3-find-pretty"><span class="toc-text">查询文档 find() pretty()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-%E4%B8%8E-RDBMS-Where-%E8%AF%AD%E5%8F%A5%E6%AF%94%E8%BE%83"><span class="toc-text">MongoDB 与 RDBMS Where 语句比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-AND-%E6%9D%A1%E4%BB%B6"><span class="toc-text">MongoDB AND 条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-OR-%E6%9D%A1%E4%BB%B6"><span class="toc-text">MongoDB OR 条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AND-%E5%92%8C-OR-%E8%81%94%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-text">AND 和 OR 联合使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">条件操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#type%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%92%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">$type操作符和数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-%E6%93%8D%E4%BD%9C%E7%AC%A6-type-%E5%AE%9E%E4%BE%8B"><span class="toc-text">MongoDB 操作符 - $type 实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#limit%E5%92%8Cskip%E6%96%B9%E6%B3%95"><span class="toc-text">limit和skip方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-text">排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-text">各种不同类型的索引的创建与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB-%E7%B4%A2%E5%BC%95"><span class="toc-text">MongoDB 索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E9%94%AE%E7%B4%A2%E5%BC%95"><span class="toc-text">单键索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-text">复合索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E9%94%AE%E7%B4%A2%E5%BC%95"><span class="toc-text">多键索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%B4%A2%E5%BC%95"><span class="toc-text">文本索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2dsphere%E7%B4%A2%E5%BC%95"><span class="toc-text">2dsphere索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2d%E7%B4%A2%E5%BC%95"><span class="toc-text">2d索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hashed%E7%B4%A2%E5%BC%95"><span class="toc-text">Hashed索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%B1%9E%E6%80%A7"><span class="toc-text">索引属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA"><span class="toc-text">索引创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BA%A4%E9%9B%86"><span class="toc-text">索引交集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%B4%A2%E5%BC%95"><span class="toc-text">管理索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A1%E9%87%8F%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="toc-text">衡量索引的使用情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%AD%96%E7%95%A5"><span class="toc-text">索引策略</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E7%9A%84%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">复杂的聚合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%95%B0%E6%8D%AE%E9%9B%86%E5%90%88%E8%BF%9B%E8%A1%8C%E5%88%86%E7%89%87-%E5%9C%A8%E4%B8%8D%E5%90%8C%E5%88%86%E7%89%87%E9%97%B4%E7%BB%B4%E6%8C%81%E5%9D%87%E8%A1%A1"><span class="toc-text">对数据集合进行分片 在不同分片间维持均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-text">数据备份与恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-text">数据迁移</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%BF%90%E7%BB%B4-MongoDB"><span class="toc-text">简单运维 MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-MongoDB-%E9%9B%86%E7%BE%A4"><span class="toc-text">部署 MongoDB 集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%A4%9A%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%85%E9%9A%9C"><span class="toc-text">处理多种常见的故障</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%8A%82%E7%82%B9%E5%A4%B1%E6%95%88-%E5%A6%82%E4%BD%95%E6%81%A2%E5%A4%8D%E5%B7%A5%E4%BD%9C"><span class="toc-text">单节点失效 如何恢复工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%84%8F%E5%A4%96%E8%A2%AB%E6%9D%80%E6%AD%BB%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="toc-text">数据库意外被杀死如何进行数据恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%91%E7%94%9F%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%97%B6%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E5%8E%9F%E5%9B%A0"><span class="toc-text">数据库发生拒绝服务时如何排查原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%A3%81%E7%9B%98%E5%BF%AB%E6%BB%A1%E6%97%B6%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86"><span class="toc-text">数据库磁盘快满时如何处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%BE%E5%BA%A6"><span class="toc-text">难度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%BF%90%E7%BB%B4%E4%B8%80%E4%B8%AA%E5%87%A0%E5%8D%81T%E7%94%9A%E8%87%B3%E4%B8%8A%E7%99%BET%E7%9A%84MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">如何运维一个几十T甚至上百T的MongoDB数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%BB%B4%E6%8C%81%E5%87%A0%E5%8D%81%E4%B8%AA%E7%94%9A%E8%87%B3%E4%B8%8A%E7%99%BE%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%9D%87%E8%A1%A1"><span class="toc-text">如何维持几十个甚至上百个节点的MongoDB数据库的均衡</span></a></li></ol></li></ol>
              <a href="#" id="article-toc-top">Back to Top</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner">
    <strong class="sidebar-title">MySQL</strong><a href="/database/mysql/index.html" class="sidebar-link">概览</a><a href="/database/mysql/booboo_mysql/index.html" class="sidebar-link">MySQL 基础</a><a href="/database/mysql/dba_mysql/index.html" class="sidebar-link">MySQL 运维实践</a><a href="/database/mysql/rds_mysql/index.html" class="sidebar-link">RDS 性能调优</a><a href="/database/mysql/security/index.html" class="sidebar-link">安全篇</a><a href="/database/mysql/awesome-tools/index.html" class="sidebar-link">工具篇</a><strong class="sidebar-title">Oracle</strong><a href="/database/oracle/index.html" class="sidebar-link">概览</a><a href="/database/oracle/ocp/index.html" class="sidebar-link">Oracle12C OCP</a><a href="/database/oracle/oracle-12c/index.html" class="sidebar-link">Oracle 12c 学习笔记</a><a href="/database/oracle/oracle-11g/index.html" class="sidebar-link">Oracle 11g 学习笔记</a><strong class="sidebar-title">NoSQL</strong><a href="/database/nosql/index.html" class="sidebar-link">概览</a><a href="/database/nosql/booboo_redis/index.html" class="sidebar-link">Redis 基础</a><a href="/database/nosql/dba_redis/index.html" class="sidebar-link">Redis 进阶</a><a href="/database/nosql/booboo_mongodb/index.html" class="sidebar-link">MongoDB 基础</a><a href="/database/nosql/hadoop/index.html" class="sidebar-link">Hadoop 基础</a><strong class="sidebar-title">TiDB</strong><a href="/database/tidb/index.html" class="sidebar-link">概览</a><a href="/database/tidb/00_tidb入门指南.html" class="sidebar-link">TiDB 入门指南</a><a href="/database/tidb/01_raft协议理解.html" class="sidebar-link">Raft协议理解</a><a href="/database/tidb/tidb_courses/index.html" class="sidebar-link">TiDB 21天课程</a>
  </div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2025 <a href="https://github.com/BoobooWei" target="_blank">魏亚萍</a><br>
      Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.<br>
      备案号：沪ICP备2020026043号
    </div>
    <div id="footer-links">
      <a href="https://www.youtube.com/@amyreading2023" class="footer-link" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" 
            alt="YouTube"
            style="height:24px; margin-bottom:-6px;">
      </a>
      <a href="https://github.com/BoobooWei" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="../../../docs/" class="mobile-nav-link">Hexo</a><a href="../../../news/" class="mobile-nav-link">News</a><a href="../../../api/" class="mobile-nav-link">MySQL8.0</a><a href="../../../database/" class="mobile-nav-link">Database</a><a href="../../../linux/" class="mobile-nav-link">Linux</a><a href="../../../cloud/" class="mobile-nav-link">Cloud</a><a href="../../../singapore/" class="mobile-nav-link">Singapore</a><a href="../../../amy/" class="mobile-nav-link">AMY</a><a href="../../../about/" class="mobile-nav-link">About</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/BoobooWei" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <strong class="mobile-nav-title">MySQL</strong><a href="/database/mysql/index.html" class="mobile-nav-link">概览</a><a href="/database/mysql/booboo_mysql/index.html" class="mobile-nav-link">MySQL 基础</a><a href="/database/mysql/dba_mysql/index.html" class="mobile-nav-link">MySQL 运维实践</a><a href="/database/mysql/rds_mysql/index.html" class="mobile-nav-link">RDS 性能调优</a><a href="/database/mysql/security/index.html" class="mobile-nav-link">安全篇</a><a href="/database/mysql/awesome-tools/index.html" class="mobile-nav-link">工具篇</a><strong class="mobile-nav-title">Oracle</strong><a href="/database/oracle/index.html" class="mobile-nav-link">概览</a><a href="/database/oracle/ocp/index.html" class="mobile-nav-link">Oracle12C OCP</a><a href="/database/oracle/oracle-12c/index.html" class="mobile-nav-link">Oracle 12c 学习笔记</a><a href="/database/oracle/oracle-11g/index.html" class="mobile-nav-link">Oracle 11g 学习笔记</a><strong class="mobile-nav-title">NoSQL</strong><a href="/database/nosql/index.html" class="mobile-nav-link">概览</a><a href="/database/nosql/booboo_redis/index.html" class="mobile-nav-link">Redis 基础</a><a href="/database/nosql/dba_redis/index.html" class="mobile-nav-link">Redis 进阶</a><a href="/database/nosql/booboo_mongodb/index.html" class="mobile-nav-link">MongoDB 基础</a><a href="/database/nosql/hadoop/index.html" class="mobile-nav-link">Hadoop 基础</a><strong class="mobile-nav-title">TiDB</strong><a href="/database/tidb/index.html" class="mobile-nav-link">概览</a><a href="/database/tidb/00_tidb入门指南.html" class="mobile-nav-link">TiDB 入门指南</a><a href="/database/tidb/01_raft协议理解.html" class="mobile-nav-link">Raft协议理解</a><a href="/database/tidb/tidb_courses/index.html" class="mobile-nav-link">TiDB 21天课程</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- Cookie -->
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<!-- build:js build/js/main.js -->

<script src="../../../js/lang_select.js"></script>


<script src="../../../js/mobile_nav.js"></script>

<!-- endbuild -->

<!-- Algolia -->
<!--   backup
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript">
docsearch({
  appId: '',
  apiKey: '',
  indexName: '',
  insights: true,
  container: '#docsearch',
  debug: false,
  searchParameters: {
    facetFilters: ['lang:en']
  }
});
</script>
-->

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
document.getElementById('search-input-wrap').classList.add('on');
docsearch({
    apiKey: '',
    indexName: '',
    inputSelector: '#search-input'
});
</script>
</body>
</html>